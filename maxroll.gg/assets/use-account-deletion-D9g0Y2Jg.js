import{g as A}from"./index-0f3ee958-DZWNGZaJ.js";import{r as n}from"./jsx-runtime-BmCkTyBI.js";import"./index-B7uSRlxY.js";import{u as D}from"./context-D_yk-qIR.js";import{g as y,s as g}from"./local-storage-utils-D-tYHVlb.js";import{i as a}from"./identity-pending-deletion-alert-displayed-cache-Bfsdi8KO.js";const s="/ory-user-deletions",m=async t=>fetch(`${t}${s}/schedule-info`,{method:"GET",credentials:"include"}).then(e=>{if(!e.ok)throw new Error("Failed to get account deletion schedule info");return e.json()}),C=async t=>fetch(`${t}${s}`,{method:"GET",credentials:"include"}).then(e=>{if(!e.ok)throw new Error("Failed to get scheduled account deletion");return e.json()}).then(e=>e?{scheduledAt:new Date(e.scheduledAt)}:null),E=async t=>fetch(`${t}${s}`,{method:"DELETE",credentials:"include"}).then(e=>{if(!e.ok)throw new Error("Failed to revoke account deletion")}),w=async t=>fetch(`${t}${s}`,{method:"POST",credentials:"include"}).then(e=>{if(!e.ok)throw new Error("Failed to request account deletion");return e.json()}).then(e=>({scheduledAt:new Date(e.scheduledAt)})),k=()=>{const{userBackendUrl:t}=D(),e=n.useCallback(()=>m(t),[t]),o=n.useCallback(()=>C(t),[t]),c=n.useCallback(()=>w(t),[t]),u=n.useCallback(()=>E(t),[t]);return{getScheduleInfo:e,getScheduledDeletion:o,scheduleDeletion:c,revokeDeletion:u}},p=n.createContext(null),i="identity_deletion_scheduled_at",S=1e3*60*60*24,x={get:t=>{const e=y(i);if(!(!e||t!==e.identityId))return e.scheduledAt?{scheduledAt:new Date(e.scheduledAt)}:{scheduledAt:void 0}},set:(t,e)=>{const o={identityId:t,scheduledAt:e==null?void 0:e.toISOString()};g(i,o,S)},clear:()=>{localStorage.removeItem(i)}},T=()=>{const t=n.useContext(p);if(!t)throw new Error("useAccountDeletionContext must be used within an AccountDeletionContextProvider");return t},$=()=>{const{scheduledAt:t,setScheduledAt:e}=T(),{scheduleDeletion:o,revokeDeletion:c,getScheduleInfo:u}=k(),{notifyWithPromise:r}=A(),d=n.useCallback(async()=>{const l=o();try{await r(l,{content:{pending:{content:"Processing your request..."},success:{content:"Request successfully processed."},error:{content:"Could not process your request. Please try again later."}}}),x.clear(),a.clear(),window.location.href="auth/logout"}catch{}},[r,o]),h=n.useCallback(async()=>{const l=c();try{await r(l,{content:{pending:{content:"Processing request..."},success:{content:"The account deletion request has been cancelled"},error:{content:"Could not process your request. Please try again later."}}}),e(void 0),a.clear()}catch{}},[r,c,e]);return{schedule:d,revoke:h,scheduledAt:t,getScheduleInfo:u}};export{p as A,k as a,x as i,$ as u};
