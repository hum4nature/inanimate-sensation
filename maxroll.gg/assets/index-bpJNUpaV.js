import{r as d}from"./jsx-runtime-BmCkTyBI.js";var D={303:"Multiple adapter contexts detected. This might happen in monorepos.",404:"nuqs requires an adapter to work with your framework.",409:"Multiple versions of the library are loaded. This may lead to unexpected behavior. Currently using `%s`, but `%s` (via the %s adapter) was about to load on top.",414:"Max safe URL length exceeded. Some browsers may not be able to accept this URL. Consider limiting the amount of state stored in the URL.",429:"URL update rate-limited by the browser. Consider increasing `throttleMs` for key(s) `%s`. %O",500:"Empty search params cache. Search params can't be accessed in Layouts.",501:"Search params cache already populated. Have you called `parse` twice?"};function M(e){return`[nuqs] ${D[e]}
  See https://err.47ng.com/NUQS-${e}`}function te(e){if(e.size===0)return"";const t=[];for(const[r,n]of e.entries()){const a=r.replace(/#/g,"%23").replace(/&/g,"%26").replace(/\+/g,"%2B").replace(/=/g,"%3D").replace(/\?/g,"%3F");t.push(`${a}=${R(n)}`)}return"?"+t.join("&")}function R(e){return e.replace(/%/g,"%25").replace(/\+/g,"%2B").replace(/ /g,"+").replace(/#/g,"%23").replace(/&/g,"%26").replace(/"/g,"%22").replace(/'/g,"%27").replace(/`/g,"%60").replace(/</g,"%3C").replace(/>/g,"%3E").replace(/[\x00-\x1F]/g,t=>encodeURIComponent(t))}var A=j();function g(e,...t){if(!A)return;const r=_(e,...t);performance.mark(r);try{console.log(e,...t)}catch{console.log(r)}}function k(e,...t){A&&console.warn(e,...t)}function _(e,...t){return e.replace(/%[sfdO]/g,r=>{const n=t.shift();return r==="%O"&&n?JSON.stringify(n).replace(/"([^"]+)":/g,"$1:"):String(n)})}function j(){try{if(typeof localStorage>"u")return!1;const e="nuqs-localStorage-test";localStorage.setItem(e,e);const t=localStorage.getItem(e)===e;if(localStorage.removeItem(e),!t)return!1}catch(e){return console.error("[nuqs]: debug mode is disabled (localStorage unavailable).",e),!1}return(localStorage.getItem("debug")??"").includes("nuqs")}var q=d.createContext({useAdapter(){throw new Error(M(404))}});q.displayName="NuqsAdapterContext";A&&typeof window<"u"&&(window.__NuqsAdapterContext&&window.__NuqsAdapterContext!==q&&console.error(M(303)),window.__NuqsAdapterContext=q);function re(e){return({children:t,...r})=>d.createElement(q.Provider,{...r,value:{useAdapter:e}},t)}function V(){const e=d.useContext(q);if(!("useAdapter"in e))throw new Error(M(404));return e.useAdapter()}function I(e,t,r){try{return e(t)}catch(n){return k("[nuqs] Error while parsing value `%s`: %O"+(r?" (for key `%s`)":""),t,n,r),null}}function B(){var e;if(typeof window>"u"||!window.GestureEvent)return 50;try{const t=(e=navigator.userAgent)==null?void 0:e.match(/version\/([\d\.]+) safari/i);return parseFloat(t[1])>=17?120:320}catch{return 320}}var v=B(),b=new Map,i={history:"replace",scroll:!1,shallow:!0,throttleMs:v},C=new Set,U=0,y=null;function G(e){return b.get(e)}function J(){b.clear(),C.clear(),i.history="replace",i.scroll=!1,i.shallow=!0,i.throttleMs=v}function Q(e,t,r,n){const a=t===null?null:r(t);return g("[nuqs queue] Enqueueing %s=%s %O",e,a,n),b.set(e,a),n.history==="push"&&(i.history="push"),n.scroll&&(i.scroll=!0),n.shallow===!1&&(i.shallow=!1),n.startTransition&&C.add(n.startTransition),i.throttleMs=Math.max(n.throttleMs??v,Number.isFinite(i.throttleMs)?i.throttleMs:0),a}function H(){return new URLSearchParams(location.search)}function K({getSearchParamsSnapshot:e=H,updateUrl:t,rateLimitFactor:r=1}){return y===null&&(y=new Promise((n,a)=>{if(!Number.isFinite(i.throttleMs)){g("[nuqs queue] Skipping flush due to throttleMs=Infinity"),n(e()),setTimeout(()=>{y=null},0);return}function m(){U=performance.now();const[c,f]=W({updateUrl:t,getSearchParamsSnapshot:e});f===null?n(c):a(c),y=null}function h(){const c=performance.now()-U,f=i.throttleMs,S=r*Math.max(0,Math.min(f,f-c));g("[nuqs queue] Scheduling flush in %f ms. Throttled at %f ms",S,f),S===0?m():setTimeout(m,S)}setTimeout(h,0)})),y}function W({updateUrl:e,getSearchParamsSnapshot:t}){const r=t();if(b.size===0)return[r,null];const n=Array.from(b.entries()),a={...i},m=Array.from(C);J(),g("[nuqs queue] Flushing queue %O with options %O",n,a);for(const[h,c]of n)c===null?r.delete(h):r.set(h,c);try{return X(m,()=>{e(r,{history:a.history,scroll:a.scroll,shallow:a.shallow})}),[r,null]}catch(h){return console.error(M(429),n.map(([c])=>c).join(),h),[r,h]}}function X(e,t){const r=n=>{if(n===e.length)return t();const a=e[n];if(!a)throw new Error("Invalid transition function");a(()=>r(n+1))};r(0)}function Y(e){return{all:e=e||new Map,on:function(t,r){var n=e.get(t);n?n.push(r):e.set(t,[r])},off:function(t,r){var n=e.get(t);n&&(r?n.splice(n.indexOf(r)>>>0,1):e.set(t,[]))},emit:function(t,r){var n=e.get(t);n&&n.slice().map(function(a){a(r)}),(n=e.get("*"))&&n.slice().map(function(a){a(t,r)})}}}function p(e){function t(r){if(typeof r>"u")return null;let n="";if(Array.isArray(r)){if(r[0]===void 0)return null;n=r[0]}return typeof r=="string"&&(n=r),I(e.parse,n)}return{eq:(r,n)=>r===n,...e,parseServerSide:t,withDefault(r){return{...this,defaultValue:r,parseServerSide(n){return t(n)??r}}},withOptions(r){return{...this,...r}}}}var ne=p({parse:e=>e,serialize:e=>`${e}`}),$=p({parse:e=>{const t=parseInt(e);return Number.isNaN(t)?null:t},serialize:e=>Math.round(e).toFixed()});p({parse:e=>{const t=$.parse(e);return t===null?null:t-1},serialize:e=>$.serialize(e+1)});p({parse:e=>{const t=parseInt(e,16);return Number.isNaN(t)?null:t},serialize:e=>{const t=Math.round(e).toString(16);return t.padStart(t.length+t.length%2,"0")}});p({parse:e=>{const t=parseFloat(e);return Number.isNaN(t)?null:t},serialize:e=>e.toString()});var ae=p({parse:e=>e==="true",serialize:e=>e?"true":"false"});function E(e,t){return e.valueOf()===t.valueOf()}p({parse:e=>{const t=parseInt(e);return Number.isNaN(t)?null:new Date(t)},serialize:e=>e.valueOf().toString(),eq:E});p({parse:e=>{const t=new Date(e);return Number.isNaN(t.valueOf())?null:t},serialize:e=>e.toISOString(),eq:E});p({parse:e=>{const t=new Date(e.slice(0,10));return Number.isNaN(t.valueOf())?null:t},serialize:e=>e.toISOString().slice(0,10),eq:E});function se(e){return p({parse:t=>{const r=t;return e.includes(r)?r:null},serialize:t=>t.toString()})}var z=Y();function oe(e,{history:t="replace",shallow:r=!0,scroll:n=!1,throttleMs:a=v,parse:m=l=>l,serialize:h=String,eq:c=(l,s)=>l===s,defaultValue:f=void 0,clearOnDefault:S=!0,startTransition:F}={history:"replace",scroll:!1,shallow:!0,throttleMs:v,parse:l=>l,serialize:String,eq:(l,s)=>l===s,clearOnDefault:!0,defaultValue:void 0}){const l=V(),s=l.searchParams,N=d.useRef((s==null?void 0:s.get(e))??null),[O,T]=d.useState(()=>{const u=G(e),o=u===void 0?(s==null?void 0:s.get(e))??null:u;return o===null?null:I(m,o,e)}),x=d.useRef(O);g("[nuqs `%s`] render - state: %O, iSP: %s",e,O,(s==null?void 0:s.get(e))??null),d.useEffect(()=>{const u=(s==null?void 0:s.get(e))??null;if(u===N.current)return;const o=u===null?null:I(m,u,e);g("[nuqs `%s`] syncFromUseSearchParams %O",e,o),x.current=o,N.current=u,T(o)},[s==null?void 0:s.get(e),e]),d.useEffect(()=>{function u({state:o,query:w}){g("[nuqs `%s`] updateInternalState %O",e,o),x.current=o,N.current=w,T(o)}return g("[nuqs `%s`] subscribing to sync",e),z.on(e,u),()=>{g("[nuqs `%s`] unsubscribing from sync",e),z.off(e,u)}},[e]);const P=d.useCallback((u,o={})=>{let w=Z(u)?u(x.current??f??null):u;(o.clearOnDefault??S)&&w!==null&&f!==void 0&&c(w,f)&&(w=null);const L=Q(e,w,h,{history:o.history??t,shallow:o.shallow??r,scroll:o.scroll??n,throttleMs:o.throttleMs??a,startTransition:o.startTransition??F});return z.emit(e,{state:w,query:L}),K(l)},[e,t,r,n,a,F,l.updateUrl,l.getSearchParamsSnapshot,l.rateLimitFactor]);return[O??f??null,P]}function Z(e){return typeof e=="function"}export{ae as G,se as J,oe as K,re as S,g as b,Y as c,ne as j,M as n,te as y};
