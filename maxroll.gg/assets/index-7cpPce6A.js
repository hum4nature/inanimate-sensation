import{r as o,j as e}from"./jsx-runtime-BmCkTyBI.js";import{c as X}from"./mid-ad-container-CtoYpZdm.js";import{y as Y}from"./useSyncLeagueStores-9jK57x3p.js";import{H as U,aK as _,a2 as ee,as as se,aw as ae,C as q,F as ie,aL as L,n as W,ad as te,f as $,ag as le,ah as ne,ai as re,aa as C,ak as ce,an as oe,ao as de,ap as fe,aq as ue,L as me,e as ge,U as he,V as pe,p as xe}from"./useUiStateStore-BTW2eq2x.js";import{s as J}from"./index-0f3ee958-DZWNGZaJ.js";import"./index-B7uSRlxY.js";import{s as ve,a as je,G as ye,h as be,c as V}from"./obscenity-Bs8f5lhx.js";import{s as we,E as Ne,I as Se,a as $e,i as Ce,$ as ke,g as Ie,P as Le}from"./hover-card-evu0jAM8.js";import{y as Me,g as Oe,u as D}from"./tabs-dB-_aH7C.js";import{c as ze}from"./dialog-BgY3zGCx.js";import{t as Pe}from"./info-CilF81GL.js";import{o as F}from"./list-checks-BsovS5X-.js";import{d as Ae}from"./service-table-columns-Bq_v5G7F.js";const Te=(d,s,a,t,i)=>{const{t:n}=U(),[u,y]=o.useState([]),h=o.useCallback(r=>r==null?void 0:r.map(c=>{const f=c.isCustomService?void 0:_(s,c.serviceCategory,c.serviceName);let v=c.serviceName;if(c.isCustomService){const b=ve.getAllMatches(v||"");v=je.applyTo(v||"",b)}else v=f?f.group&&!f.hideGroupPrefix?n("services.groupedService",{group:n(`services.${f.group}`),service:n(`services.${f.label||f.value}`)}):n(`services.${f.label||f.value}`):n(`services.${c.serviceName.replace("Cruel","")}`);return{...c,priceValue:c.priceValue??void 0,priceType:c.priceType??void 0,serviceNameItem:f,shownServiceName:v}}).filter(c=>c!==void 0),[s,n]),p=o.useMemo(()=>(u==null?void 0:u.filter(r=>!t||r.location===t))||[],[u,t]),m=o.useMemo(()=>p==null?void 0:p.filter(r=>r.inactive===(i==="inactive")),[p,i]),k=r=>{let c=[];typeof r=="function"?c=r(m):c=r,y(c)},{data:g,isFetching:M}=ee({...se(d,s,a),select:h}),x=o.useMemo(()=>(g==null?void 0:g.filter(r=>!t||r.location===t))||[],[g,t]),w=o.useMemo(()=>x==null?void 0:x.filter(r=>r.inactive===(i==="inactive")),[x,i]);return o.useEffect(()=>{g&&y([...g])},[g,y,i,t]),{modifiedListings:m,setModifiedListings:k,originalListings:w}};var R,E;function Ve(){return E||(E=1,R=function d(s,a){if(s===a)return!0;if(s&&a&&typeof s=="object"&&typeof a=="object"){if(s.constructor!==a.constructor)return!1;var t,i,n;if(Array.isArray(s)){if(t=s.length,t!=a.length)return!1;for(i=t;i--!==0;)if(!d(s[i],a[i]))return!1;return!0}if(s instanceof Map&&a instanceof Map){if(s.size!==a.size)return!1;for(i of s.entries())if(!a.has(i[0]))return!1;for(i of s.entries())if(!d(i[1],a.get(i[0])))return!1;return!0}if(s instanceof Set&&a instanceof Set){if(s.size!==a.size)return!1;for(i of s.entries())if(!a.has(i[0]))return!1;return!0}if(ArrayBuffer.isView(s)&&ArrayBuffer.isView(a)){if(t=s.length,t!=a.length)return!1;for(i=t;i--!==0;)if(s[i]!==a[i])return!1;return!0}if(s.constructor===RegExp)return s.source===a.source&&s.flags===a.flags;if(s.valueOf!==Object.prototype.valueOf)return s.valueOf()===a.valueOf();if(s.toString!==Object.prototype.toString)return s.toString()===a.toString();if(n=Object.keys(s),t=n.length,t!==Object.keys(a).length)return!1;for(i=t;i--!==0;)if(!Object.prototype.hasOwnProperty.call(a,n[i]))return!1;for(i=t;i--!==0;){var u=n[i];if(!d(s[u],a[u]))return!1}return!0}return s!==s&&a!==a}),R}var De=Ve();const Fe=ae(De);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=[["path",{d:"M11 12H3",key:"51ecnj"}],["path",{d:"M16 6H3",key:"1wxfjs"}],["path",{d:"M16 18H3",key:"12xzn7"}],["path",{d:"m19 10-4 4",key:"1tz659"}],["path",{d:"m15 10 4 4",key:"1n7nei"}]],H=q("list-x",Re);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["rect",{x:"3",y:"5",width:"6",height:"6",rx:"1",key:"1defrl"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]],B=q("list-todo",Ee),K=["serviceCategory","serviceName","ign","location","message","priceValue","rewards","tags","contactDirection"],G=we({columnSizing:{},pageSize:100,columnOrder:[],columnVisiblity:{rewards:!1,tags:!1,ign:!1},scrollMode:"windowInfinite",rowHeight:49},{persistPrefix:"my-service-listing-tool",version:4,migrate(d,s){return s===1?{...d,columnOrder:K}:{}}}),He=({className:d,poe:s,columns:a,selectedStatus:t,setSelectedStatus:i,currentLocation:n,originalListings:u,setCurrentLocation:y,modifiedListings:h,setModifiedListings:p})=>{const{t:m}=U(),k=ie(),g=ye({onSuccess:()=>{i(t==="active"?"inactive":"active")}}),M=o.useCallback((l,j,S)=>{p(I=>{const O=I.findIndex(Q=>L(Q)===l),z=[...I];return O!==-1&&(z[O]={...z[O],[j]:S}),z})},[p]),[x,w]=o.useState(""),{tableRef:r,handleTableReset:c}=Ne(),{tableState:f,setTablePageIndex:v}=Se(G),b=o.useCallback(l=>{w(l),v(0)},[w,v]),P=o.useCallback((l,j,S,I)=>$e.includesString(l,j,S,I),[]),A=o.useCallback(l=>!Fe(l,u.find(j=>L(j)===L(l))),[u]),Z=o.useMemo(()=>({data:h,columns:a,getRowId:l=>L(l),enableMultiSort:!1,onGlobalFilterChange:b,globalFilterFn:P,...f.setState,state:{globalFilter:x,...f.state},initialState:{sorting:[{id:"serviceCategory",desc:!1}],columnVisibility:{rewards:!1,tags:!1,ign:!1},columnOrder:K},meta:{updateData(l,j,S){M(l,j,S)},isDirty:A}}),[h,a,b,P,f.setState,f.state,x,A,M]),[T]=J(l=>({loaded:l.viewport.loaded,md:l.viewport.md})),N=T.loaded&&!T.md;return e.jsx(Ce,{storeContext:G,children:e.jsxs("div",{className:W("flex flex-col gap-2 w-full relative"),children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap w-full",children:[!N&&e.jsx(ke,{value:x??"",onChange:l=>b(String(l)),onBlur:l=>b(String(l)),className:"pl-8 max-w-48",placeholder:m("label.searchPh"),startIcon:e.jsx("div",{className:"p-2",children:e.jsx(te,{className:"h-4 w-4 shrink-0 opacity-50"})}),endIcon:e.jsx($,{variant:"ghost",size:"inputEndIcon",onClick:()=>{w("")},children:e.jsx(ze,{className:"w-4 h-4"})})}),e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[!N&&e.jsx(le,{delayDuration:0,children:e.jsxs(ne,{children:[e.jsx(re,{asChild:!0,children:e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(C,{children:"Online Status Info"}),e.jsx(Pe,{className:"w-4 h-4"})]})}),e.jsxs(ce,{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("div",{className:"border rounded-full w-3 h-3 bg-green-1"}),e.jsx(C,{children:m("label.statusOnlineInfo")})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("div",{className:"border rounded-full w-3 h-3 bg-yellow-500"}),e.jsx(C,{children:m("label.statusIdleInfo")})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("div",{className:"border rounded-full w-3 h-3 bg-red-1"}),e.jsx(C,{children:m("label.statusOfflineInfo")})]})]})]})}),e.jsx(Me,{value:t,onValueChange:l=>{i(l)},children:e.jsxs(Oe,{children:[e.jsx(D,{value:"active",children:m("label.active")}),e.jsx(D,{value:"inactive",children:m("label.inactive")})]})}),!N&&e.jsx(oe,{delayDuration:250,children:e.jsxs(de,{children:[e.jsx(fe,{asChild:!0,children:e.jsx($,{className:"flex gap-2 items-center",variant:"outline",size:"icon",disabled:h.length===0||g.isPending,onClick:()=>{g.mutate({addOrUpdate:h.map(l=>({...l,autoInactiveSince:null,inactive:t==="active"})),delete:[]})},children:t==="active"?e.jsx(H,{className:"h-4 w-4"}):e.jsx(F,{className:"h-4 w-4"})})}),e.jsx(ue,{children:e.jsx(C,{children:m(t==="active"?"label.setAllListingsInactiveInfo":"label.setAllListingsActiveInfo")})})]})}),!N&&e.jsxs($,{className:"flex gap-2 items-center",variant:"secondary",onClick:()=>k(`/${s}/poexchange/services/my-listings/selection`),children:[e.jsx(B,{className:"w-4 h-4"}),e.jsx("span",{children:"WTS Services"})]}),N&&e.jsxs(be,{children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("span",{children:t==="active"?"Deactivate All":"Activate All"}),e.jsx($,{className:"rounded-full",variant:"secondary",size:"floatingIcon",disabled:h.length===0||g.isPending,onClick:()=>{g.mutate({addOrUpdate:h.map(l=>({...l,autoInactiveSince:void 0,inactive:t==="active"})),delete:[]})},children:t==="active"?e.jsx(H,{className:"h-4 w-4"}):e.jsx(F,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("span",{children:"WTS Services"}),e.jsx($,{className:"rounded-full",variant:"default",size:"floatingIconPrimary",onClick:()=>k(`/${s}/poexchange/services/my-listings/selection`),children:e.jsx(B,{className:"w-5 h-5"})})]})]}),e.jsx(Ie,{columns:a,resetTable:c})]})]}),e.jsx(Le,{options:Z,tableRef:r})]})})},Be=({poe:d,league:s})=>{const[a,t]=o.useState(null),[i,n]=o.useState("active"),u=me(ge),{modifiedListings:y,setModifiedListings:h,originalListings:p}=Te(u,d,s,a,i),m=o.useMemo(()=>Ae(),[]);return e.jsx("div",{className:"overflow-auto w-full",children:e.jsx(He,{columns:m,poe:d,selectedStatus:i,setSelectedStatus:n,currentLocation:a,setCurrentLocation:t,originalListings:p,modifiedListings:y,setModifiedListings:h})})};he.extend(pe);function as(){const[d,s,a]=V(xe(n=>[n.league,n.setLeague,n.reset])),t=V(n=>n.poe);Y(t,d,s,a);const[i]=J(n=>({lg:n.viewport.lg}));return e.jsx(e.Fragment,{children:e.jsxs("div",{className:W("flex flex-col w-full"),children:[e.jsx(X,{id:"poexchange-top-ad",type:i.lg?"large-leaderboard":"medium-leaderboard"}),e.jsx(Be,{poe:t,league:d})]})})}export{as as A};
