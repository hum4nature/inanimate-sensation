import{r as w,j as R}from"./jsx-runtime-BmCkTyBI.js";import{aG as k,aH as z,aI as S,N as A,Q as W,R as B,aJ as P,u as v,i as H}from"./useUiStateStore-BTW2eq2x.js";var L=function(){return k.Date.now()},J=/\s/;function Q(i){for(var o=i.length;o--&&J.test(i.charAt(o)););return o}var _=/^\s+/;function q(i){return i&&i.slice(0,Q(i)+1).replace(_,"")}var D=NaN,F=/^[-+]0x[0-9a-f]+$/i,K=/^0b[01]+$/i,U=/^0o[0-7]+$/i,X=parseInt;function j(i){if(typeof i=="number")return i;if(z(i))return D;if(S(i)){var o=typeof i.valueOf=="function"?i.valueOf():i;i=S(o)?o+"":o}if(typeof i!="string")return i===0?i:+i;i=q(i);var p=K.test(i);return p||U.test(i)?X(i.slice(2),p?2:8):F.test(i)?D:+i}var Y="Expected a function",Z=Math.max,ee=Math.min;function te(i,o,p){var u,h,r,a,e,t,s=0,l=!1,d=!1,n=!0;if(typeof i!="function")throw new TypeError(Y);o=j(o)||0,S(p)&&(l=!!p.leading,d="maxWait"in p,r=d?Z(j(p.maxWait)||0,o):r,n="trailing"in p?!!p.trailing:n);function c(m){var T=u,$=h;return u=h=void 0,s=m,a=i.apply($,T),a}function g(m){return s=m,e=setTimeout(I,o),l?c(m):a}function M(m){var T=m-t,$=m-s,V=o-T;return d?ee(V,r-$):V}function f(m){var T=m-t,$=m-s;return t===void 0||T>=o||T<0||d&&$>=r}function I(){var m=L();if(f(m))return E(m);e=setTimeout(I,M(m))}function E(m){return e=void 0,n&&u?c(m):(u=h=void 0,a)}function N(){e!==void 0&&clearTimeout(e),s=0,u=t=h=e=void 0}function O(){return e===void 0?a:E(L())}function x(){var m=L(),T=f(m);if(u=arguments,h=this,t=m,T){if(e===void 0)return g(t);if(d)return clearTimeout(e),e=setTimeout(I,o),c(t)}return e===void 0&&(e=setTimeout(I,o)),a}return x.cancel=N,x.flush=O,x}const b=(i,o,p)=>(o||(i==null?void 0:i.category)||"")+(p||(i==null?void 0:i.subCategory)||""),y=(i,o)=>i.primaryGroup&&o[i.primaryGroup.hash]?i.calculatedTotalPrice:0,G=(i,o)=>{if(i.primaryGroup&&o[i.primaryGroup.hash])return i.originalPrice===void 0?void 0:i.originalPrice*i.stackSize},C=(i,o)=>{if(!(i===0||o===0))return v(i/o*100,1)},re=i=>{const o=H(i),p={poe:i,league:o[0],stashes:Object.fromEntries(o.map(u=>[u,[]])),category:null,subCategory:null,selectableCategories:[],selectableSubCategories:[],localMultiplier:100,globalMultiplier:100,categoryListingMode:{},minTradeValue:{},minTradeType:{},categoryMultiplier:{},selectedItems:{},modifiedItems:[],overprices:{},unselectedItems:{},totalPrice:0,customGroups:{}};return A()(W((u,h)=>({...p,reset:()=>u(p),setLeague:r=>u(a=>{let e=a.stashes;return a.league!==r&&(e={...a.stashes},e[a.league]=[]),{league:r,stashes:e}}),setStashes:r=>u(a=>{let e=a.stashes[a.league];typeof r=="function"?e=r(e):e=r;const t={...a.stashes};return t[a.league]=e,{stashes:t}}),setCategory:r=>u({category:r}),setSubCategory:r=>u({subCategory:r}),setSelectableCategories:r=>u({selectableCategories:r}),setSelectableSubCategories:r=>u({selectableSubCategories:r}),resetData:()=>{u(r=>{let a=0,e=0,t=0;const s={},l=r.modifiedItems.map(d=>{const n={...d};n.primaryGroup&&(s[n.primaryGroup.hash]=!0),n.selectedPrice=void 0,P(n,1);const c=G(n,s);return c!==void 0&&(e+=y(n,s),t+=c),a+=y(n,s),n});return{localMultiplier:100,globalMultiplier:C(e,t)??100,categoryMultiplier:{},selectedItems:s,modifiedItems:l,overprices:{},unselectedItems:{},totalPrice:v(a,4)}})},setCategoryListingMode:(r,a)=>u(e=>{let t=e.categoryListingMode;const s=a||b(e);return t={...e.categoryListingMode,[s]:r},t={...e.categoryListingMode,[s]:r},{categoryListingMode:t}}),setMinTradeValue:(r,a)=>u(e=>{const t=a||b(e);let s=e.minTradeValue,l=e.minTradeType;return r!==void 0?(s={...e.minTradeValue,[t]:r},e.minTradeType[t]===void 0&&(l={...e.minTradeType,[t]:"c"})):(e.minTradeValue[t]!==void 0&&(s={...e.minTradeValue},delete s[t]),e.minTradeType[t]!==void 0&&(l={...e.minTradeType},delete l[t])),{minTradeValue:s,minTradeType:l}}),setMinTradeType:(r,a)=>u(e=>{const t=a||b(e);return{minTradeType:{...e.minTradeType,[t]:r}}}),debouncedMultiplier:te(r=>h().setMultiplier(r),5),setLocalMultiplier:r=>{u(a=>(a.debouncedMultiplier(r),{localMultiplier:r,isDebouncing:!0}))},setMultiplier:(r,a)=>u(e=>{let t=e.categoryMultiplier;const s=a||b(e);t={...e.categoryMultiplier,[s]:r};let l=0,d=0,n=0;return{modifiedItems:e.modifiedItems.map(c=>{const g={...c};P(g,r/100);const M=G(g,e.selectedItems);return M!==void 0&&(d+=y(g,e.selectedItems),n+=M),l+=y(g,e.selectedItems),g}),localMultiplier:r,globalMultiplier:C(d,n)??r,isDebouncing:!1,totalPrice:v(l,4),categoryMultiplier:t}}),setInitialItems:r=>u(a=>{const e={};r.forEach(n=>{n.primaryGroup&&!a.unselectedItems[n.primaryGroup.hash]&&(e[n.primaryGroup.hash]=!0)});const t=b(a)&&a.categoryMultiplier[b(a)]||100;let s=0,l=0,d=0;return r.forEach(n=>{P(n,t/100);const c=G(n,e);c!==void 0&&(l+=y(n,e),d+=c),s+=y(n,e)}),{modifiedItems:r,totalPrice:v(s,4),selectedItems:e,localMultiplier:t,globalMultiplier:C(l,d)??t}}),setSelectedItems:r=>u(a=>{let e={};const t={...a.unselectedItems};typeof r=="function"?e=r(a.selectedItems):e=r;let s=0,l=0,d=0;return a.modifiedItems.forEach(n=>{n.primaryGroup&&(e[n.primaryGroup.hash]?t[n.primaryGroup.hash]!==void 0&&delete t[n.primaryGroup.hash]:t[n.primaryGroup.hash]=!0);const c=G(n,e);c!==void 0&&(l+=y(n,e),d+=c),s+=y(n,e)}),{selectedItems:e,unselectedItems:t,totalPrice:v(s,4),globalMultiplier:C(l,d)??a.localMultiplier}}),updateData:(r,a,e)=>u(t=>{let s=0,l=0,d=0;const n={...t.overprices};return{modifiedItems:t.modifiedItems.map(c=>{var M;if(`${((M=c.primaryGroup)==null?void 0:M.hash)||c.displayName}`===r){if(a==="selectedPrice"){const f={...c};typeof e=="number"?f.selectedPrice=e:f.selectedPrice=void 0,P(f,t.localMultiplier/100);const I=G(f,t.selectedItems);return I!==void 0&&(l+=y(f,t.selectedItems),d+=I),s+=y(f,t.selectedItems),f.primaryGroup&&(f.selectedPrice!==void 0?n[f.primaryGroup.hash]=f.selectedPrice:n[f.primaryGroup.hash]!==void 0&&delete n[f.primaryGroup.hash]),f}return{...c,[a]:e}}const g=G(c,t.selectedItems);return g!==void 0&&(l+=y(c,t.selectedItems),d+=g),s+=y(c,t.selectedItems),c}),totalPrice:v(s,4),overprices:n,globalMultiplier:C(l,d)??t.localMultiplier}}),updateCustomGroupGroups:(r,a)=>u(e=>{var s,l;const t={...e.customGroups};return t[r]={meta:((s=t[r])==null?void 0:s.meta)||{},groups:a||((l=t[r])==null?void 0:l.groups)||[]},{customGroups:t}}),updateCustomGroupMeta:(r,a)=>u(e=>{var s,l;const t={...e.customGroups};return t[r]={meta:{...(s=t[r])==null?void 0:s.meta,...a||{}},groups:((l=t[r])==null?void 0:l.groups)||[]},{customGroups:t}})}),{name:`poexchange-${i}-offering-items-store`,storage:B(()=>localStorage),partialize:u=>({league:u.league,categoryListingMode:u.categoryListingMode,minTradeValue:u.minTradeValue,minTradeType:u.minTradeType,categoryMultiplier:u.categoryMultiplier,overprices:u.overprices,unselectedItems:u.unselectedItems,customGroups:u.customGroups}),version:0,migrate:(u,h)=>{}}))},ie=w.createContext(null),ue=({children:i,poe:o})=>{const p=w.useRef();return(!p.current||p.current.getState().poe!==o)&&(p.current=re(o)),R.jsx(ie.Provider,{value:p.current,children:i})};export{b as f,ue as m,ie as s};
