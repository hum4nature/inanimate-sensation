import{r as b,j as i}from"./jsx-runtime-BmCkTyBI.js";import{y as f,h as Y,v as Z,f as ee}from"./hover-card-evu0jAM8.js";import{F as ie}from"./currency-input-DZgJ7P6M.js";import{x as ae,g as se,N as re,f as le,w as te,h as ne}from"./input-CP8d1LBk.js";import{H as w,P as oe,b as ce,g as de,C as ue,ag as k,ah as D,ai as F,aj as me,ak as M,aa as T,f as C,al as he,af as ge,n as I,G as pe,L as xe,e as fe,J as ve,y as je,am as ye,a5 as W,an as be,ao as we,ap as Ne,aq as Se}from"./useUiStateStore-BTW2eq2x.js";import{g as $e}from"./check-column-0JE1AfPu.js";import{j as Ce,k as ke,D as De}from"./dialog-BgY3zGCx.js";import"./tabs-dB-_aH7C.js";import{s as Fe}from"./index-0f3ee958-DZWNGZaJ.js";import"./index-B7uSRlxY.js";import{o as G,J as K,c as O,t as Me,G as Te}from"./obscenity-Bs8f5lhx.js";import{t as R}from"./info-CilF81GL.js";import{a as Oe}from"./trash-2-CKNrPGIi.js";const ze=({className:d,id:r,options:l,selectedOptions:e,onSelectedOptionsChange:t,keyword:s})=>{const{t:c}=w(),[h,a]=b.useState(!1);return i.jsxs(oe,{open:h,onOpenChange:a,modal:!0,children:[i.jsx(ce,{asChild:!0,children:i.jsx(ae,{id:r,className:d,comboboxOpen:h,children:e.length>0?i.jsx("div",{className:"flex flex-row gap-2",children:c("label.optionsSelected",{keyword:s,count:e.length,plural:e.length>1?"s":""})}):i.jsx(i.Fragment,{children:c("label.selectOptionPh",{keyword:s})})})}),i.jsx(de,{sideOffset:5,className:"p-0 max-h-[var(--radix-popover-content-available-height)] w-[var(--radix-popover-trigger-width)] min-w-[150px] max-w-[var(--radix-popover-content-available-width)] overflow-hidden",children:i.jsxs(se,{children:[i.jsx(re,{placeholder:c("label.searchOptionPh",{keyword:s})}),i.jsx(le,{children:l.map(n=>{const o=n,u=e.some(v=>v===n);return i.jsx(te,{selected:u,onSelect:()=>{if(u){const v=e.filter(N=>N!==n);t(v||[])}else t([...e,n]);a(!0)},isMulti:!0,children:i.jsx("span",{className:"whitespace-pre-wrap",children:n})},o)})}),i.jsx(ne,{children:c("label.noResults")})]})})]})};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=[["path",{d:"M22 13V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v12c0 1.1.9 2 2 2h8",key:"12jkf8"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}],["path",{d:"M19 16v6",key:"tddt3s"}],["path",{d:"M16 19h6",key:"xwg31i"}]],B=ue("mail-plus",Le);function Ve(d){const r="serviceCategory",l="serviceCategory";return{header:({column:e})=>i.jsx(f,{column:e,title:l,align:"left"}),id:r,accessorKey:r,accessorFn:e=>e.serviceCategory,enableSorting:!0,enableGlobalFilter:!0,size:150,meta:{headerWording:l,fillRemainingSize:!0},cell:({row:e})=>{const{t}=w(),s=e.getValue(r);return i.jsx("div",{className:"flex items-center h-full",children:i.jsxs("span",{className:"truncate hover:overflow-x-auto hover:text-clip scrollbar-hidden",onMouseLeave:c=>c.currentTarget.scrollLeft=0,children:[e.original.creatorType==="wts"?"WTS - ":"WTB - ",t(`serviceCategory.${s}`)]})})},...d}}function E(d){const r="serviceName",l="serviceName";return{header:({column:e})=>i.jsx(f,{column:e,title:l,align:"left"}),id:r,accessorKey:r,accessorFn:e=>e.shownServiceName,enableSorting:!0,enableGlobalFilter:!0,size:150,meta:{headerWording:l,fillRemainingSize:!0},cell:({row:e})=>{var s,c;const t=e.getValue(r);return i.jsxs("div",{className:"flex items-center gap-2 h-full",children:[((s=e.original.serviceNameItem)==null?void 0:s.icon)&&i.jsx("img",{src:(c=e.original.serviceNameItem)==null?void 0:c.icon,height:32,width:32,alt:"Service Icon",sizes:"33vw",style:{width:"auto",height:"32px",objectFit:"contain",flexShrink:0,paddingBlock:"0.125rem"}}),e.original.isCustomService&&i.jsx(k,{delayDuration:150,children:i.jsxs(D,{children:[i.jsx(F,{asChild:!0,children:i.jsx(me,{className:"h-4 w-4 flex-shrink-0"})}),i.jsx(M,{children:i.jsx(T,{children:"Custom Service"})})]})}),i.jsx("span",{className:"truncate hover:overflow-x-auto hover:text-clip scrollbar-hidden",onMouseLeave:h=>h.currentTarget.scrollLeft=0,children:t})]})},...d}}function A(d){const r="message";return{header:({column:l})=>i.jsx(f,{column:l,align:"left"}),id:r,accessorKey:r,accessorFn:l=>l.message,enableSorting:!1,enableGlobalFilter:!1,size:25,maxSize:25,meta:{headerWording:"message"},cell:({table:l,row:e,column:t})=>{const s=e.getValue(r),[c]=Fe(a=>({loaded:a.viewport.loaded,mobile:a.viewport.mobile})),h=b.useCallback(a=>{var n,o;(o=(n=l.options.meta)==null?void 0:n.updateData)==null||o.call(n,e.id,t.id,a)},[e.id,t.id,l.options.meta]);return i.jsx("div",{className:"flex items-center justify-center h-full",children:i.jsx(Ce,{children:i.jsxs(Y,{openDelay:50,closeDelay:500,children:[c.loaded&&!c.mobile&&i.jsx(Z,{asChild:!0,children:s?i.jsx(G,{className:"h-4 w-4 flex-shrink-0"}):i.jsx(B,{className:"h-4 w-4 flex-shrink-0"})}),c.loaded&&c.mobile&&i.jsx(ke,{asChild:!0,children:i.jsx(C,{variant:"ghost",size:"icon",children:s?i.jsx(G,{className:"h-4 w-4 flex-shrink-0"}):i.jsx(B,{className:"h-4 w-4 flex-shrink-0"})})}),c.loaded&&!c.mobile&&i.jsx(ee,{sideOffset:5,side:"left",align:"start",className:"flex flex-col w-80 p-2 gap-2 max-h-[var(--radix-hover-card-content-available-height)] max-w-[var(--radix-popover-content-available-width)] overflow-hidden",children:i.jsx(K,{poe:e.original.poe,mode:"edit",message:s,setMessage:h})}),c.loaded&&c.mobile&&i.jsx(De,{children:i.jsx(K,{poe:e.original.poe,message:s,isDialog:!0,mode:"edit",setMessage:a=>{var n,o;return(o=(n=l.options.meta)==null?void 0:n.updateData)==null?void 0:o.call(n,e.id,"message",a)}})})]})})})},...d}}function Pe(d){const r="ign",l="ign";return{header:({column:e})=>i.jsx(f,{column:e,title:l,align:"left"}),id:r,accessorKey:r,enableSorting:!0,enableGlobalFilter:!1,enableResizing:!0,meta:{headerWording:l,className:"text-left"},cell:({row:e})=>{const t=e.getValue(r);return i.jsx("div",{className:"flex items-center h-full w-full",children:t})},...d}}function We(d){const r="location",l="location";return{header:({column:e})=>i.jsx(f,{column:e,title:l,align:"left"}),id:r,accessorKey:r,accessorFn:e=>e.location,enableSorting:!0,enableGlobalFilter:!0,meta:{headerWording:l},cell:({row:e})=>{const{t}=w(),s=e.getValue(r);return i.jsx("div",{className:"flex items-center gap-2 h-full",children:e.original.serviceCategory==="bossKilling"?i.jsxs(k,{delayDuration:0,children:[i.jsx("span",{className:"truncate",children:t(s==="Buyer"?"body.locationBuyersMap":"body.locationSellerMap")}),i.jsxs(D,{children:[i.jsx(F,{asChild:!0,children:i.jsx(R,{className:"w-4 h-4"})}),i.jsx(M,{children:i.jsx(T,{children:t(s==="Buyer"?"label.buyersBossLoot":"label.sellersBossLoot")})})]})]}):s==="Buyer"?i.jsx("span",{className:"truncate",children:t("body.locationBuyersMap")}):i.jsx("span",{className:"truncate",children:t("body.locationSellerMap")})})},...d}}function q(d){const r="rewards",l="rewards";return{header:({column:e})=>i.jsx(f,{column:e,title:l,align:"left"}),id:r,accessorKey:r,accessorFn:e=>{var t,s;return(s=(t=e.serviceNameItem)==null?void 0:t.rewards)==null?void 0:s.join(", ")},enableSorting:!0,enableGlobalFilter:!0,size:150,meta:{headerWording:l},cell:({row:e})=>{var n;const{t}=w(),s=(n=e.original.serviceNameItem)==null?void 0:n.rewards,c=O(o=>o.poe),h=b.useMemo(()=>he(c,e.original.serviceCategory),[c,e.original.serviceCategory]),a=b.useMemo(()=>{var o;return(o=h.find(u=>u.value===e.original.serviceCategory))==null?void 0:o.services.find(u=>u.value===e.original.serviceName)},[e.original.serviceCategory,e.original.serviceName,h]);return i.jsx("div",{className:"flex items-center h-full",children:i.jsx("div",{className:"truncate w-full space-x-1 hover:overflow-x-auto hover:text-clip scrollbar-hidden",onMouseLeave:o=>o.currentTarget.scrollLeft=0,children:s==null?void 0:s.map(o=>i.jsxs(ge,{variant:"secondary",className:I("inline-flex items-center gap-1 capitalize",e.original.location==="Seller"&&(a==null?void 0:a.buyersMapOnly)&&o==="atlasPassivePoint"&&"line-through"),children:[t(`serviceRewards.${o}`),e.original.location==="Seller"&&(a==null?void 0:a.buyersMapOnly)&&o==="atlasPassivePoint"&&i.jsx(k,{children:i.jsxs(D,{children:[i.jsx(F,{children:i.jsx(R,{className:"w-3.5 h-3.5"})}),i.jsx(M,{children:"The buyer will not receive the Atlas Passive Point reward."})]})})]},o))})})},...d}}function H(d){const r="tags",l="overwriteRules";return{header:({column:e})=>i.jsx(f,{column:e,title:l,align:"left"}),id:r,accessorKey:r,accessorFn:e=>{var t;return(t=e.tags)==null?void 0:t.join(", ")},enableSorting:!0,enableGlobalFilter:!0,minSize:36,meta:{headerWording:l},cell:({row:e,table:t})=>{const{t:s}=w(),c=e.original.tags||[];return i.jsx("div",{className:"flex items-center h-full",children:i.jsx(ze,{options:Me,selectedOptions:c,onSelectedOptionsChange:h=>{var a,n;(n=(a=t.options.meta)==null?void 0:a.updateData)==null||n.call(a,e.id,"tags",h)},keyword:s("label.rulesKw")})})},...d}}function J(d){const r="priceValue",l="price";return{header:({column:e})=>i.jsx(f,{column:e,title:l,align:"right"}),id:r,accessorKey:r,enableSorting:!0,enableGlobalFilter:!1,enableResizing:!0,meta:{headerWording:l,className:"text-right"},cell:({row:e,table:t,column:s})=>{const c=e.getValue(r),h=O(n=>n.poe),a=b.useCallback((n,o=s.id)=>{var u,v;(v=(u=t.options.meta)==null?void 0:u.updateData)==null||v.call(u,e.id,o,n)},[s.id,e.id,t.options.meta]);return i.jsx("div",{className:"flex items-center justify-end h-full w-full",children:i.jsx(ie,{poe:h,priceValue:c,priceType:e.original.priceType,onValueChange:a,onTypeChange:n=>{var o,u;(u=(o=t.options.meta)==null?void 0:o.updateData)==null||u.call(o,e.id,"priceType",n)}})})},...d}}function Ge(d){const r="actions",l="actions";return{header:({column:e})=>i.jsx(f,{column:e,title:l,align:"right"}),id:r,accessorKey:r,enableSorting:!1,enableGlobalFilter:!1,meta:{headerWording:l},cell:({row:e,table:t})=>{const{t:s}=w(["common","notification"]),c=O(g=>g.poe),h=pe(),a=xe(fe),n=ve(),o=!e.original.inactive,u=!e.original.inactive,{mutate:v,isPending:N}=je({mutationFn:({id:g,listing:p})=>ye(g,p),onError:g=>{n(s("notification:error.title.postServiceListings"),"error")},onSuccess:(g,p,Ke)=>{var L;const m=p.listing;h.setQueryData(["my-service-listings",(L=a==null?void 0:a.profile)==null?void 0:L.uuid,m.poe,m.league],S=>S?S.map(y=>y.id===m.id?{...y,...m}:y):void 0);const z=[m.serviceCategory];m.creatorType==="wtb"&&z.push("WTB_all"),z.forEach(S=>{var y;h.setQueryData(["service-listings",(y=a==null?void 0:a.profile)==null?void 0:y.uuid,m.poe,m.league,S,m.isCustomService?null:m.serviceName],$=>{if(!$)return;const V=$.filter(x=>{var j;return x.userId!==((j=a==null?void 0:a.profile)==null?void 0:j.uuid)}),P=$.filter(x=>{var j;return x.userId===((j=a==null?void 0:a.profile)==null?void 0:j.uuid)});if(m.inactive){const x=P.filter(j=>m.id!==j.id);return[...V,...x]}const X=P.map(x=>m.id===x.id?{...x,message:m.message,priceValue:m.priceValue,priceType:m.priceType,contactDirection:m.contactDirection,tags:m.tags,updatedAt:new Date,userStatus:"online"}:x);return[...V,...X]})})}}),{mutate:Q,isPending:U}=Te({onError:()=>s("notification:error.title.deleteServiceListing")}),_=b.useMemo(()=>{var g,p;return(p=(g=t.options.meta)==null?void 0:g.isDirty)==null?void 0:p.call(g,e.original)},[e.original,t.options.meta]);return i.jsxs("div",{className:"flex items-center gap-2 justify-end h-full",children:[i.jsxs(C,{className:"flex gap-2 items-center",variant:"secondary",disabled:N||!_&&u,onClick:()=>{var g,p;return v({id:e.original.id,listing:u?{...e.original,message:((g=e.original.message)==null?void 0:g.trim())||null}:{...e.original,message:((p=e.original.message)==null?void 0:p.trim())||null,autoInactiveSince:void 0,inactive:!1}})},children:[N&&i.jsx(W,{className:"w-4 h-4 animate-spin"}),u?i.jsx("span",{children:s("action.updateService")}):i.jsx("span",{children:s("action.setListingActive")})]}),i.jsx(be,{children:i.jsxs(we,{children:[i.jsx(Ne,{asChild:!0,children:i.jsx(C,{className:"flex gap-2 items-center",size:"icon",variant:"outline",disabled:N,onClick:()=>{Q({addOrUpdate:[],delete:[{id:e.original.id,poe:c,league:e.original.league,location:e.original.location,serviceCategory:e.original.serviceCategory,serviceName:e.original.serviceName,isCustomService:e.original.isCustomService}],setToDeleteInactive:o})},children:U?i.jsx(W,{className:I("w-4 h-4 animate-spin")}):i.jsx(Oe,{className:"w-4 h-4 shrink-0"})})}),i.jsx(Se,{className:"whitespace-pre-line",children:i.jsx(T,{children:s(o?"action.removeActiveOffering":"action.removeInactiveOffering")})})]})})]})},...d}}const Ze=()=>[$e(),E(),A(),J(),q(),H()],ei=()=>[Ve(),E(),Pe(),We(),A(),J(),q(),H(),Ge()];export{Ze as c,ei as d,ze as q};
