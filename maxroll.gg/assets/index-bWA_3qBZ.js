var Rs=Object.defineProperty;var Vs=(a,i,n)=>i in a?Rs(a,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[i]=n;var O=(a,i,n)=>Vs(a,typeof i!="symbol"?i+"":i,n);import{r as o,j as e}from"./jsx-runtime-BmCkTyBI.js";import{t as Ge}from"./listing-category-select-D6xid_4F.js";import{c as Os}from"./mid-ad-container-CtoYpZdm.js";import{m as fe,G as $e,n as Ie,j as es,x as zs,g as _s,N as Qs,l as As,y as Gs,w as Ds,t as Le,h as Hs,i as Ws,o as qs}from"./input-CP8d1LBk.js";import{X as Ee,k as Fe,bg as Ks,bw as Us,bx as Bs,by as ss,H as D,n as B,f as _,P as Xs,b as Ys,af as De,an as le,ao as re,ap as oe,aq as ce,aa as P,g as Js,r as Zs,t as ts,s as et,z as as,v as st,ar as tt,W as at,at as it,J as nt,a2 as is,bz as lt,au as rt,a6 as ot,bu as ct,h as dt,bA as ut,L as Pe,e as Me,m as Re,y as mt,bB as ht,p as G,ac as ge,ag as ve,ah as Ne,ai as Se,aE as gt,ak as Ce,b3 as He,d as Ve,l as Oe,a7 as ze,a9 as ns,ad as ls,ae as rs,a5 as os,U as pe,V as cs,bC as xt,bf as ft,bD as pt}from"./useUiStateStore-BTW2eq2x.js";import{i as We}from"./skeleton-uQgPEDp6.js";import{a as bt,t as qe}from"./info-CilF81GL.js";import{c as ae,h as jt,b as yt,w as wt,F as vt,j as Nt,D as St}from"./dialog-BgY3zGCx.js";import{a as Te}from"./funnel-Ivj98osJ.js";import{v as Ct,x as Tt,g as kt,h as $t}from"./accordion-n3zJuvLo.js";import{y as Ft}from"./useSyncLeagueStores-9jK57x3p.js";import{s as It}from"./index-0f3ee958-DZWNGZaJ.js";import"./index-B7uSRlxY.js";import{c as ds}from"./store-provider-Ubnk8f1_.js";import{c as Lt,I as Et,P as us,y as ee,$ as _e,s as ms,a as hs,E as gs,i as xs,g as fs,O as Pt,d as Mt,b as Rt,w as Vt,e as Ot}from"./hover-card-evu0jAM8.js";import{t as ps,y as bs,U as zt,F as _t,Y as Qt,$ as Ke}from"./layout-list-CWMZJz9E.js";import{h as js,F as At,f as Gt,K as Dt}from"./store-DLU3xr0A.js";import{h as Ht}from"./scroll-area-r19cRpaW.js";import{y as Wt,g as qt,u as Ue,b as Be}from"./tabs-dB-_aH7C.js";import{c as Xe,b as Kt,a as Ut,I as ys,g as ws,y as vs,m as xe,d as ke,l as Ye}from"./quantity-column-6vZwNzJV.js";import{Q as Ns}from"./whisper.utils-B4Kh6tfH.js";import{i as Bt}from"./useMainIgn-C4RS_MXP.js";import{c as Xt}from"./useSkipper-BPqtXzmD.js";import{g as Yt}from"./check-column-0JE1AfPu.js";import{u as Qe}from"./multiplier-column-DxfWu9Tp.js";import{N as U,A as Jt}from"./price-column-DkIVfYGp.js";const Zt=(a,i,n,t,l=!0)=>{Object.entries(t).length!==0&&Object.entries(n.summaries).forEach(([r,s])=>{i.some(m=>{var v;const c=(v=m.filter)==null?void 0:v.call(m,{primaryGroup:{tag:n.meta.tag,key:s.key,unsafeHashProperties:s.unsafeHashProperties}},"preItemFilter");return c===!0||c===void 0})&&Object.entries(t).forEach(([m,c])=>{c.forEach(v=>{const x=Bs({...s.unsafeHashProperties,extended:{[m]:v}});if(l&&!i.some(u=>{var h;const y=(h=u.filter)==null?void 0:h.call(u,{primaryGroup:{tag:n.meta.tag,key:s.key,unsafeHashProperties:x}},"afterItemFilter");return y===!0||y===void 0}))return;const f=ss({tag:n.meta.tag,key:s.key,propertiesHash:x},{unorderedArrays:!0,unorderedObjects:!0});a.set(f,{...s,unsafeHashProperties:x})})})})},ea=(a,i,n)=>{const t=o.useMemo(()=>Ee(i,n),[i,n]),l=o.useCallback(s=>{const m=new Map;let c=[];const v=s.every(u=>!u.isPending);v&&s.length>0&&(s.filter(u=>u.data).map(u=>u.data).forEach(u=>{var y,h;(h=((y=t==null?void 0:t.summaryTagVariants)==null?void 0:y.filter(d=>d.tag===u.meta.tag))||(t==null?void 0:t.tags.map(d=>({tag:d,variants:void 0}))))==null||h.forEach(d=>{t&&(d!=null&&d.variants)?Zt(m,[t],u,d.variants,!0):Object.entries(u.summaries).forEach(([b,j])=>{var g;const p={primaryGroup:{tag:u.meta.tag,key:j.key,unsafeHashProperties:j.unsafeHashProperties}};((g=t==null?void 0:t.filter)==null?void 0:g.call(t,p))!==!1&&m.set(b,u.summaries[b])})})}),c=Array.from(m).map(([u,y])=>{const h=Fe(y.unsafeHashProperties,!1,t==null?void 0:t.hiddenColumnProps).map(d=>d.value.toLowerCase());return{hash:u,key:y.key,displayName:y.displayName.replace(/(^\w{1})|(\s+\w{1})/g,d=>d.toUpperCase()),icon:y.icon,unsafeHashProperties:y.unsafeHashProperties,priceProps:h}}).sort((u,y)=>`${u.displayName} ${u.priceProps.join(" ")}`.localeCompare(`${y.displayName} ${y.priceProps.join(" ")}`)));const x=s.some(u=>u.isError),f=s.some(u=>u.isLoading);return{summaries:v?m:void 0,options:v?c:void 0,categoryItem:t,isSummaryPending:!v,isSummaryLoading:f,isSummaryError:x}},[t]),r=o.useMemo(()=>t!=null&&t.summaryTagVariants?[...new Set(t==null?void 0:t.summaryTagVariants.map(s=>s.tag))]:(t==null?void 0:t.tags)||[],[t==null?void 0:t.summaryTagVariants,t==null?void 0:t.tags]);return Ks({queries:(r==null?void 0:r.map(s=>Us(a,s)))||[],combine:l})},sa=({league:a,className:i,category:n,subCategory:t,filterGroups:l,onFilterGroupsChange:r})=>{const{t:s}=D(),[m,c]=o.useState(!1),v=o.useRef([]),x=o.useMemo(()=>l.map((b,j)=>p=>{let g=p;typeof p=="function"?g=p(v.current[j]||l[j]):g=p;const w=[...l];w[j]=g,v.current[j]=g,r(w)}),[l,r]),f=o.useMemo(()=>l.map((b,j)=>()=>{const p=[...l];p.splice(j,1),r(p)}),[l,r]),{options:u,categoryItem:y,isSummaryPending:h}=ea(a,n,t);function d(b){r([...l,{mode:b,filters:[],selected:!0}])}return e.jsxs("div",{className:B("flex flex-col gap-4",i),children:[l.map((b,j)=>e.jsx(aa,{options:u,group:b,loading:h,onGroupChange:x[j],removeGroup:f[j],categoryItem:y},`${j}_${n}_${t}`)),m?e.jsx("div",{className:"self-end w-32",children:e.jsx(fe,{options:["AND","NOT","COUNT"],onSelect:b=>{d(b.value),c(!1)},open:m,onOpenChange:b=>{setTimeout(()=>c(b),0)},translate:!0})}):e.jsx(_,{className:"self-end",variant:"outline",onClick:()=>c(!0),children:s("action.addGroup")})]})},ta=({options:a,group:i,loading:n,categoryItem:t,onGroupChange:l,removeGroup:r})=>{const{t:s}=D(),[m,c]=o.useState(!1),[v,x]=o.useState(!1),f=o.useMemo(()=>{const g=i.filters.filter(w=>{var T;return w.selected&&w.freeText===void 0&&((T=w.option)==null?void 0:T.hash)}).flatMap(w=>w.option.hash);return(a||[]).filter(w=>!g.includes(w.hash))},[i.filters,a]),[u,y]=o.useMemo(()=>{const g=i.filters.map(($,C)=>({...$,index:C})).filter($=>$.selected&&$.freeText!==void 0),w={},T=f.filter($=>{const C=g.find(k=>$e($.displayName.toLowerCase(),k.freeText,$.priceProps)>0);return C&&(w[C.index]?w[C.index].push($):w[C.index]=[$]),!C});return[w,T]},[i.filters,f]);function h(){l({...i,selected:!i.selected})}function d(g){l({...i,mode:g,minimumQuantity:void 0})}const b=o.useCallback(g=>{l({...i,filters:i.filters.filter((w,T)=>T!==g)})},[i,l]),j=o.useCallback((g,w)=>{l(T=>{const $=[...T.filters];return $[g]=w,{...T,filters:$}})},[l]),p=g=>{const w=parseInt(g.target.value);Number.isNaN(w)||w<0?l({...i,minimumQuantity:void 0}):l({...i,minimumQuantity:w})};return e.jsxs("div",{className:"flex flex-col gap-1 px-2 mt-1",children:[e.jsxs("div",{className:"flex flex-row items-center px-1 gap-4",children:[e.jsx(Ie,{checked:i.selected,onClick:()=>h()}),e.jsxs("div",{className:"flex flex-row w-full items-center gap-2",children:[!m&&e.jsx(_,{className:"flex flex-1 justify-start hover:bg-inherit border-b rounded-none",variant:"ghost",onClick:()=>h(),children:s(`option.${i.mode}`)}),m&&e.jsx("div",{className:"flex flex-1 justify-start hover:bg-inherit",children:e.jsx(fe,{options:["AND","NOT","COUNT"],onSelect:g=>{c(!1),d(g.value)},defaultOption:i.mode,open:v,onOpenChange:g=>{x(g),g||setTimeout(()=>c(!1),0)}})}),e.jsx(_,{size:"icon",variant:"ghost",onClick:()=>{c(!0),x(!0)},children:e.jsx(bt,{className:"w-4 h-4"})}),i.mode==="COUNT"&&e.jsx(es,{type:"number",className:"max-w-20 text-center remove-arrow",placeholder:s("label.min"),min:0,value:i.minimumQuantity||"",onChange:p}),e.jsx(_,{className:"w-9 h-9",size:"icon",variant:"ghost",onClick:()=>r(),children:e.jsx(ae,{className:"w-4 h-4"})})]})]}),i.selected&&e.jsxs(e.Fragment,{children:[i.filters.map((g,w)=>e.jsx(Je,{options:a,availableOptions:y,freeTextAvailableOptions:u[w],isNextFilter:!1,filter:g,filterGroupMode:i.mode,index:w,loading:n,categoryItem:t,updateFilter:j,removeFilter:b},w)),e.jsx(Je,{options:a,availableOptions:y,isNextFilter:!0,filter:{option:null,freeTextOptions:null,freeTextMode:i.mode==="AND"?"OR":void 0,selected:!0,minimumQuantity:void 0},filterGroupMode:i.mode,index:i.filters.length,loading:n,categoryItem:t,updateFilter:j,removeFilter:b},i.filters.length)]})]})},aa=o.memo(ta);function ia({options:a,availableOptions:i,freeTextAvailableOptions:n,filter:t,filterGroupMode:l,index:r,updateFilter:s,removeFilter:m,isNextFilter:c,loading:v,categoryItem:x}){var T,$;const{t:f}=D(),[u,y]=o.useState(!1),[h,d]=o.useMemo(()=>{let C;return t.option&&(C=a==null?void 0:a.find(k=>{var M;return k.hash===((M=t.option)==null?void 0:M.hash)})),t.freeText===void 0?[C,void 0]:[void 0,C]},[t.freeText,t.option,a]);o.useEffect(()=>{a&&t.option&&!h&&!d&&(t.freeText!==void 0?s(r,{...t,option:null}):m(r))},[t.option,r,a,m,h,d]);const b=C=>{const k=parseFloat(C.target.value);Number.isNaN(k)||k<=0?s(r,{...t,minimumQuantity:void 0}):s(r,{...t,minimumQuantity:k})},[j,p]=o.useState(((T=t.option)==null?void 0:T.displayName)||""),g=o.useMemo(()=>t.freeText!==void 0?t.freeText?(n||[]).map(C=>({option:C,score:$e(C.displayName.toLowerCase(),t.freeText,C.priceProps)})).filter(C=>C.score>0).sort((C,k)=>k.score-C.score).map(C=>C.option):n||[]:[],[t.freeText,n]),w=o.useMemo(()=>{let C=i;return j?(g.length>0&&(C=[...i,...g]),t.freeText===void 0&&g.length===0&&t.option&&t.selected&&(C=[t.option,...C]),C.map(k=>({option:k,score:$e(k.displayName.toLowerCase(),j,k.priceProps)})).filter(k=>k.score>0).sort((k,M)=>M.score-k.score).map(k=>k.option)):g.length>0?[...i,...g]:(t.freeText===void 0&&g.length===0&&t.option&&t.selected&&(C=[t.option,...C]),C)},[i,t.freeText,t.option,t.selected,g,j]);return o.useEffect(()=>{a&&t.freeText!==void 0&&s(r,{...t,freeTextOptions:[...g]})},[a,g.length]),e.jsxs("div",{className:"flex flex-row items-center px-1 gap-4",children:[c?e.jsx("div",{className:"w-4 h-4 shrink-0"}):e.jsx(Ie,{checked:t.selected,onClick:()=>{s(r,{...t,selected:!t.selected})}}),e.jsxs("div",{className:"flex flex-row w-full items-center gap-2",children:[e.jsxs(Xs,{open:u,onOpenChange:C=>{t.freeText!==void 0&&p(t.freeText),y(C)},children:[e.jsx(Ys,{asChild:!0,children:e.jsx(zs,{comboboxOpen:u,children:h?e.jsxs("div",{className:"flex gap-2 items-center justify-between group",children:[e.jsxs("div",{className:"flex gap-2 items-center flex-[2_1_0%] min-w-0",children:[e.jsx("img",{width:24,height:24,src:h.icon,alt:"d",className:"block h-5 min-h-fit shrink-0"}),e.jsx("span",{className:"truncate",children:h.displayName})]}),e.jsx("div",{className:"flex items-center flex-[1_1_0%] min-w-[56px] overflow-hidden justify-end",children:e.jsx("span",{className:"flex items-center gap-1 whitespace-nowrap overflow-hidden mr-2",children:Fe(h.unsafeHashProperties,!1,x==null?void 0:x.hiddenColumnProps).map(({name:C,value:k})=>e.jsx(De,{variant:"secondary",className:"capitalize shrink-0",children:k},C))})})]}):t.freeText!==void 0?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex gap-2 w-full items-center justify-between",children:[e.jsxs("div",{className:"flex gap-2 items-center flex-1 min-w-0",children:[d&&e.jsx("img",{width:20,height:20,src:d.icon,alt:"d",className:"block h-5 min-h-fit min-w-fit shrink-0"}),e.jsx("div",{className:"truncate",children:t.freeText})]}),e.jsxs("div",{className:"flex gap-2 items-center mr-2 shrink-0",children:[e.jsx(Te,{className:"w-4 h-4"}),($=t.freeTextOptions)==null?void 0:$.length]})]})}):e.jsx(e.Fragment,{children:f("label.selectPh")})})}),h&&t.freeText===void 0&&e.jsx(le,{children:e.jsxs(re,{children:[e.jsx(oe,{asChild:!0,children:e.jsx(_,{variant:"ghost",size:"icon",className:"shrink-0",onClick:()=>{s(r,{...t,freeText:h.displayName,freeTextMode:"OR",freeTextOptions:[...w]})},children:e.jsx(Te,{className:"w-4 h-4"})})}),e.jsx(ce,{children:e.jsx(P,{children:f("label.itemToTextFilterTT")})})]})}),t.freeText!==void 0&&e.jsx(le,{children:e.jsxs(re,{children:[e.jsx(oe,{asChild:!0,children:e.jsx(_,{variant:"ghost",size:"icon",className:"shrink-0",onClick:()=>{s(r,{...t,freeTextMode:t.freeTextMode==="OR"?"AND":"OR"})},children:f(t.freeTextMode==="OR"?"option.OR":"option.AND")})}),e.jsx(ce,{children:e.jsx(P,{children:f(t.freeTextMode==="OR"?"label.freeTextModeOrTT":"label.freeTextModeAndTT")})})]})}),e.jsx(Js,{sideOffset:3,className:"p-0 max-h-[var(--radix-popover-content-available-height)] w-[var(--radix-popover-trigger-width)] min-w-[150px] max-w-[var(--radix-popover-content-available-width)] overflow-hidden",children:e.jsxs(_s,{shouldFilter:!1,children:[e.jsx(Qs,{value:j,onValueChange:p,className:"data-[end-icon=true]:pr-14",placeholder:f("label.searchPh"),endIcon:e.jsx(le,{children:e.jsxs(re,{children:[e.jsx(oe,{asChild:!0,children:e.jsxs(_,{variant:"ghost",className:"flex gap-2 items-center p-2 h-8 rounded-none",onClick:()=>{s(r,{...t,option:t.option&&j.startsWith(t.option.displayName)?t.option:null,freeText:j,freeTextMode:"OR",freeTextOptions:[...w]}),y(!1)},children:[e.jsx(Te,{className:"w-4 h-4 shrink-0"}),w.length]})}),e.jsx(ce,{children:e.jsx(P,{children:f("label.serachToTextFilterTT")})})]})})}),e.jsx(As,{style:{height:"min(calc(var(--radix-popover-content-available-height) - 7rem), var(--cmdk-virtual-list-height))"},totalCount:v?5:w.length,itemContent:C=>v?e.jsx(Gs,{children:e.jsxs("div",{className:"flex items-center space-x-4 w-full",children:[e.jsx(We,{className:"h-7 w-7 shrink-0 rounded-full"}),e.jsx(We,{className:"h-4 flex flex-1"})]})},C):e.jsx(Ds,{value:w[C].hash,onSelect:k=>{const M=a==null?void 0:a.find(F=>F.hash===k);s(r,{...t,option:M??null,freeTextMode:void 0,freeText:void 0,freeTextOptions:[]}),y(!1)},disableSelection:!0,children:e.jsxs("div",{className:"flex flex-row gap-2 items-center w-full",children:[e.jsx("img",{className:"min-w-5",width:20,height:20,src:w[C].icon,alt:"d"}),e.jsx("span",{className:"flex flex-1 whitespace-normal",children:w[C].displayName}),w[C].hash===(h==null?void 0:h.hash)&&e.jsx("span",{className:"flex items-center justify-center",children:e.jsx(Le,{className:"h-4 w-4 shrink-0"})}),e.jsx("span",{className:"flex flex-col gap-1 items-end shrink-0",children:Fe(w[C].unsafeHashProperties,!1,x==null?void 0:x.hiddenColumnProps).map(({name:k,value:M})=>e.jsx(De,{variant:"secondary",className:"capitalize flex-shrink",children:M},k))})]})},w[C].hash)}),e.jsx(Hs,{children:f("label.noResults")})]})})]}),c?e.jsx("div",{className:"max-w-20 w-full"}):e.jsx(es,{type:"number",className:"max-w-20 text-center remove-arrow",placeholder:f("label.min"),min:1,value:t.minimumQuantity||"",onChange:b}),c?e.jsx("div",{className:"min-w-9"}):e.jsx(_,{className:"w-9 h-9 min-w-9",size:"icon",variant:"ghost",onClick:()=>m(r),children:e.jsx(ae,{className:"w-4 h-4"})})]})]})}const Je=o.memo(ia),na=o.memo(sa);var be="Switch",[la,fi]=Zs(be),[ra,oa]=la(be),Ss=o.forwardRef((a,i)=>{const{__scopeSwitch:n,name:t,checked:l,defaultChecked:r,required:s,disabled:m,value:c="on",onCheckedChange:v,form:x,...f}=a,[u,y]=o.useState(null),h=ts(i,g=>y(g)),d=o.useRef(!1),b=u?x||!!u.closest("form"):!0,[j,p]=et({prop:l,defaultProp:r??!1,onChange:v,caller:be});return e.jsxs(ra,{scope:n,checked:j,disabled:m,children:[e.jsx(as.button,{type:"button",role:"switch","aria-checked":j,"aria-required":s,"data-state":$s(j),"data-disabled":m?"":void 0,disabled:m,value:c,...f,ref:h,onClick:st(a.onClick,g=>{p(w=>!w),b&&(d.current=g.isPropagationStopped(),d.current||g.stopPropagation())})}),b&&e.jsx(ks,{control:u,bubbles:!d.current,name:t,value:c,checked:j,required:s,disabled:m,form:x,style:{transform:"translateX(-100%)"}})]})});Ss.displayName=be;var Cs="SwitchThumb",Ts=o.forwardRef((a,i)=>{const{__scopeSwitch:n,...t}=a,l=oa(Cs,n);return e.jsx(as.span,{"data-state":$s(l.checked),"data-disabled":l.disabled?"":void 0,...t,ref:i})});Ts.displayName=Cs;var ca="SwitchBubbleInput",ks=o.forwardRef(({__scopeSwitch:a,control:i,checked:n,bubbles:t=!0,...l},r)=>{const s=o.useRef(null),m=ts(s,r),c=Ws(n),v=tt(i);return o.useEffect(()=>{const x=s.current;if(!x)return;const f=window.HTMLInputElement.prototype,u=Object.getOwnPropertyDescriptor(f,"checked").set;if(c!==n&&u){const y=new Event("click",{bubbles:t});u.call(x,n),x.dispatchEvent(y)}},[c,n,t]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n,...l,tabIndex:-1,ref:m,style:{...l.style,...v,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});ks.displayName=ca;function $s(a){return a?"checked":"unchecked"}var Fs=Ss,da=Ts;const Is=o.forwardRef(({className:a,...i},n)=>e.jsx(Fs,{className:B("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-dark-5",a),...i,ref:n,children:e.jsx(da,{className:B("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));Is.displayName=Fs.displayName;const I=a=>{const i=o.useContext(ds);if(!i)throw new Error("useListingsStore must be use within ListingsStoreProvider");return it(i,a)},Ls=()=>{const a=o.useContext(ds);if(!a)throw new Error("useListingsStore must be use within ListingsStoreProvider");return a},ua=at([a=>a.selectedItemsMap,(a,i)=>i],(a,i)=>{if(!i)return!1;const n=a[(i==null?void 0:i.uuid)||""]||{},t=i.items.filter(l=>n[l.hash]&&l.selectedQuantity>0);return t.length===i.items.length&&t.every(l=>l.selectedQuantity>=l.quantity)}),ma=({activeTabNotifications:a,setIsTableLoading:i})=>{const n=I(u=>u.league),t=I(u=>dt.find(y=>y.name===u.category)),l=I(u=>{var y;return(y=u.fetchTimeStamps[u.league])==null?void 0:y[u.category||""]}),r=I(u=>u.setFetchTimestamps),s=I(u=>u.addListings),m=I(u=>u.cleanupListings),c=nt(),{data:v,isLoading:x}=is(lt(n,t,a,l,r));o.useEffect(()=>{i(!!(l===0&&x))},[i,x,l]);const{valuations:f}=rt(v);return o.useEffect(()=>{if(v&&v.length>0&&f){const u=v.map(h=>ot(h,f[h.meta.league])).filter(h=>h),y={};u.forEach(h=>{const d=h.meta.category+(h.meta.subCategory?`_${h.meta.subCategory}`:"");ct.has(`${h.meta.category}:${h.meta.subCategory}`)&&(y[d]?y[d].push(h):y[d]=[h])}),Object.entries(y).forEach(([h,d])=>{const[b,j]=h.split("_");s(c,d,b,j)})}},[v,f]),o.useEffect(()=>{const u=setInterval(()=>m(c),2e3);return()=>clearInterval(u)},[m]),null},ha=o.memo(ma);class ga{constructor(i){O(this,"canvas");O(this,"ctx");O(this,"img");O(this,"faviconSize");O(this,"badgeSize");O(this,"offset");O(this,"_value",0);O(this,"backgroundColor","#f00");O(this,"color","#fff");O(this,"size",.6);O(this,"position","ne");O(this,"radius",8);O(this,"src");O(this,"onChange");O(this,"faviconEL",document==null?void 0:document.querySelector("link[rel$=icon]"));Object.assign(this,i),this.canvas=document==null?void 0:document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.faviconEL=document==null?void 0:document.querySelector("link[rel$=icon]"),document&&(this.faviconEL||(this.faviconEL=document.createElement("link"),this.faviconEL.rel="icon",document.head.appendChild(this.faviconEL)),this.src=this.src||this.faviconEL.getAttribute("href")||"/favicon.ico")}_drawIcon(){!this.ctx||!this.img||(this.ctx.clearRect(0,0,this.faviconSize,this.faviconSize),this.ctx.drawImage(this.img,0,0,this.faviconSize,this.faviconSize))}_drawShape(){if(!this.ctx)return;const{x:i,y:n}=this.offset,t=i+this.badgeSize,l=n+this.badgeSize,r=this.radius;this.ctx.beginPath(),this.ctx.moveTo(t-r,n),this.ctx.quadraticCurveTo(t,n,t,n+r),this.ctx.lineTo(t,l-r),this.ctx.quadraticCurveTo(t,l,t-r,l),this.ctx.lineTo(i+r,l),this.ctx.quadraticCurveTo(i,l,i,l-r),this.ctx.lineTo(i,n+r),this.ctx.quadraticCurveTo(i,n,i+r,n),this.ctx.fillStyle=this.backgroundColor,this.ctx.fill(),this.ctx.closePath()}_drawVal(){if(!this.ctx)return;const i=this.badgeSize*.18/2;this.ctx.beginPath(),this.ctx.textBaseline="middle",this.ctx.textAlign="center",this.ctx.font=`bold ${this.badgeSize*.82}px Arial`,this.ctx.fillStyle=this.color,this.ctx.fillText(String(this.value),this.badgeSize/2+this.offset.x,this.badgeSize/2+this.offset.y+i),this.ctx.closePath()}_drawFavicon(){this.faviconEL&&this.faviconEL.setAttribute("href",this.dataURL)}_draw(){this._drawIcon(),this.value&&(this._drawShape(),this._drawVal()),this._drawFavicon()}_setup(){if(!this.img)return;this.faviconSize=this.img.naturalWidth,this.badgeSize=this.faviconSize*this.size,this.canvas.width=this.faviconSize,this.canvas.height=this.faviconSize;const i=this.faviconSize-this.badgeSize,n=i/2;this.offset={n:{x:n,y:0},e:{x:i,y:n},s:{x:n,y:i},w:{x:0,y:n},nw:{x:0,y:0},ne:{x:i,y:0},sw:{x:0,y:i},se:{x:i,y:i}}[this.position]}update(){var i;this.src&&(this._value=Math.min(99,parseInt(String(this._value),10)),this.img?(this.faviconSize===void 0&&this._setup(),this._draw(),(i=this.onChange)==null||i.call(this)):(this.img=new Image,this.img.addEventListener("load",()=>{var n;this._setup(),this._draw(),(n=this.onChange)==null||n.call(this)}),this.img.src=this.src))}get dataURL(){return this.canvas.toDataURL()}get value(){return this._value||0}set value(i){this._value=i,this.update()}}const Es=(a,i)=>{const{data:n,isLoading:t}=is(ut(a==null?void 0:a.uuid,!!i));return{expandedListing:o.useMemo(()=>{if(!(!a||!n))return{...a,meta:{...a.meta,stashTabs:n.stashTabs},items:a.items.map(l=>{var s;const r=(s=n.items.find(m=>m.hash===l.hash))==null?void 0:s.rawItems;return{...l,items:r}})}},[n,a]),expandedListingInfo:n,isLoading:t}},xa=(a,i,n)=>{if(a.meta.listingMode==="bulk")return a.uuid;const t=a.items.filter(r=>i[r.hash]&&r.selectedQuantity>0);if(t.length===0)return!1;if(t.length===a.items.length&&t.every(r=>r.selectedQuantity>=r.quantity))return a.uuid;const l=t.map(r=>[r.hash,r.selectedQuantity??0]);return ss([a.uuid,l,n])},fa=(a,i,n,t)=>{const l={uuid:a.uuid,ign:n,regex:t,regexWarning:!1,totalItemCount:0,items:[]};if(a.meta.listingMode==="bulk")return l.totalItemCount=a.items.reduce((s,m)=>s+m.selectedQuantity,0),l;const r=a.items.filter(s=>i[s.hash]&&s.selectedQuantity>0);if(t){const s=a.items.some(m=>m.maxSelectableQuantity&&m.selectedQuantity<m.maxSelectableQuantity);l.regexWarning=s}return r.length===a.items.length&&r.every(s=>s.selectedQuantity>=s.quantity)||(l.items=r.map(s=>[s.hash,s.selectedQuantity])),l},Ps=(a,i)=>{var h;const n=Pe(Me),t=Re(Bt),{mutate:l,isPending:r}=mt({mutationFn:ht}),s=I(d=>d.selectedItemsMap[(a==null?void 0:a.uuid)||""]),m=o.useMemo(()=>!s||!a?!1:xa(a,s,i),[a,s,i]),c=m===!1||!((h=n==null?void 0:n.profile)!=null&&h.uuid)||!t,{whisperedListings:v,addWhisperedListing:x}=I(G(d=>({whisperedListings:d.whisperedListings,addWhisperedListing:d.addWhisperedListing}))),f=o.useCallback(()=>{var d;m&&(!((d=v[(a==null?void 0:a.uuid)||""])!=null&&d.sentHashes.includes(m))&&t&&a?l({targetId:a.userId||"",type:"offering-buy",body:fa(a,s||{},t,i)},{onSuccess:()=>{x(a.uuid||"",m)}}):x((a==null?void 0:a.uuid)||"",m))},[v,x,t,m,a,l,i,s]),[u,y]=I(G(d=>m?d.whisperedListings[(a==null?void 0:a.uuid)||""]?[d.whisperedListings[(a==null?void 0:a.uuid)||""].lastCopiedHash===m,d.whisperedListings[(a==null?void 0:a.uuid)||""].sentHashes.includes(m)]:[!1,!1]:[!1,!1]));return[c,r,u,y,f]},pa=({listing:a,calculatedTotalPrice:i,minTradeValue:n,minValueWarning:t,categoryItem:l,regexFilterAsSelection:r,regexInnerFilterAsSelection:s,onRegexFilterAsSelection:m})=>{var y,h;const c=Pe(Me),v=Re(d=>d.poe),{t:x,i18n:f}=D(),u=o.useMemo(()=>a.meta.multiplier?a.meta.multiplier.toLocaleString(f.language,{minimumFractionDigits:0,maximumFractionDigits:2}):"- ",[f.language,a.meta.multiplier]);return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-6 w-fit gap-1 text-sm gap-x-3 h-fit",children:[e.jsx(P,{className:"col-span-2 text-sm",children:x("label.seller")}),e.jsxs("div",{className:"col-span-4 flex gap-2 items-center w-fit",children:[e.jsx("span",{className:"truncate"}),(y=c==null?void 0:c.profile)!=null&&y.uuid?a.meta.ign:"*****"]}),e.jsx(P,{className:"col-span-2 text-sm",children:x("label.category")}),e.jsxs("div",{className:"col-span-4 flex flex-row gap-1 items-center",children:[e.jsx("img",{className:"max-w-5 max-h-5 shrink-0",src:a.meta.icon,width:20,height:20,alt:a.meta.altIcon}),e.jsx("div",{children:x(`categories.${a.meta.subCategory||a.meta.category}`)})]}),e.jsx(P,{className:"col-span-2 text-sm",children:x("label.sellMode")}),e.jsx("div",{className:"col-span-4 flex flex-row gap-1 items-center",children:a.meta.listingMode==="bulk"?e.jsxs(e.Fragment,{children:[e.jsx(ps,{className:"w-4 h-4"}),x("label.wholeListingShort")]}):e.jsxs(e.Fragment,{children:[e.jsx(bs,{className:"w-4 h-4"}),x("label.individualListingShort")]})}),e.jsx(P,{className:"col-span-2 text-sm",children:x("label.askingPrice")}),e.jsxs("div",{className:"col-span-4 flex gap-2 items-center w-fit",children:[e.jsx(ge,{poe:v,value:i}),t&&e.jsx(ve,{delayDuration:0,children:e.jsxs(Ne,{children:[e.jsx(Se,{asChild:!0,children:e.jsx(gt,{className:"w-4 h-4 text-yellow-400"})}),e.jsx(Ce,{className:"bg-amber-600",children:e.jsx(P,{className:"whitespace-pre-line",children:x("label.minTradeValueWarning")})})]})})]}),!!n&&e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"col-span-2 text-sm",children:x("label.minTradeValue")}),e.jsx("div",{className:"col-span-4 flex gap-2 items-center w-fit",children:e.jsx(ge,{poe:v,value:n})})]}),!((h=l==null?void 0:l.hiddenColumns)!=null&&h.includes("multiplier"))&&e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"col-span-2 text-sm",children:x("label.multiplierLabel")}),e.jsxs("div",{className:"col-span-4",children:[u,"%"]})]}),(l==null?void 0:l.supportsRegex)&&e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"col-span-2 text-sm",children:x("label.regexSearchEnabledLabel")}),e.jsx("div",{className:"col-span-4 flex gap-2 items-center",children:e.jsxs(e.Fragment,{children:[a.meta.enableRegexSearch?e.jsx(Le,{className:"w-4 h-4 shrink-0"}):e.jsx(ae,{className:"w-4 h-4 shrink-0"}),e.jsx(ve,{delayDuration:0,children:e.jsxs(Ne,{children:[e.jsx(Se,{asChild:!0,children:e.jsx(qe,{className:"w-4 h-4 shrink-0"})}),e.jsx(Ce,{children:e.jsx(P,{className:"whitespace-pre-line",children:a.meta.enableRegexSearch?x("label.regexSearchAllowedTT"):x("label.regexSearchDisallowedTT")})})]})}),a.meta.enableRegexSearch&&e.jsxs("div",{className:"flex gap-1 flex-wrap",children:[e.jsx("span",{children:x("label.poeregexRecommandation1")}),e.jsx("span",{children:e.jsx(He,{className:"underline-offset-4 underline",target:"_blank",href:"https://poe.re/#/maps",children:"poe.re"})}),e.jsx("span",{children:" / "}),e.jsx("span",{children:e.jsx(He,{className:"underline-offset-4 underline",target:"_blank",href:"https://exile.re/",children:"exile.re"})}),e.jsx("span",{children:x("label.poeregexRecommandation2")})]})]})}),a.meta.enableRegexSearch&&a.meta.listingMode==="single"&&e.jsx(e.Fragment,{children:a.meta.regexExtraPrice&&e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"col-span-2 text-sm",children:x("label.regexExtraPriceLabel")}),e.jsxs("div",{className:"col-span-4 flex gap-2 items-center w-fit",children:[e.jsx(ge,{poe:v,value:a.meta.regexExtraPrice}),r&&!!a.meta.calculatedExtraPrice&&e.jsxs("div",{className:"flex gap-1 items-center",children:[e.jsx("div",{children:x("label.total")}),e.jsx(ge,{poe:v,value:a.meta.calculatedExtraPrice})]})]})]})}),a.meta.enableRegexSearch&&a.meta.listingMode==="single"&&e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"col-span-2 text-sm",children:x("label.regexFilterAsSelectionLabel")}),e.jsxs("div",{className:"col-span-4 flex items-center gap-2 w-fit",children:[e.jsx(Ie,{checked:s,onCheckedChange:d=>m(!!d)}),e.jsx(ve,{delayDuration:0,children:e.jsxs(Ne,{children:[e.jsx(Se,{asChild:!0,children:e.jsx(qe,{className:"w-4 h-4"})}),e.jsx(Ce,{children:e.jsx(P,{className:"whitespace-pre-line",children:x("label.regexFilterAsSelectionTT")})})]})})]})]})]})]})})},ba=o.memo(pa),ja=({listing:a,expandedOuterListing:i,isExpandedOuterListingLoading:n,regexFilter:t,stashViewItemState:l,onHighligtInTable:r})=>{const s=I(d=>d.selectedListingId?d.selectedItemsMap[d.selectedListingId]:void 0),{expandedListing:m}=Es(a,!i&&!n),c=i||m,v=o.useMemo(()=>{if(!c)return[];const d=[...c.meta.stashTabs.filter(b=>typeof b!="string").map(b=>({...b,items:[],parent:void 0,children:[]}))];return c.items.forEach(b=>{var j;(j=b.items)==null||j.forEach(p=>{const g=d.find(w=>w.id===p.stashTabId);g&&(g.items?g.items.push(p):g.items=[p])})}),d.filter(b=>b.items.length>0).sort((b,j)=>b.index-j.index)},[c]),x=o.useMemo(()=>Object.keys(l).length>0,[l]),f=o.useMemo(()=>{const d=[];return c==null||c.items.forEach(b=>{var p;if(!(s!=null&&s[b.hash]))return;let j=b.selectedQuantity;(p=b.items)==null||p.forEach(g=>{if(!g.stashTabId)return;let w=t===void 0;t&&Xe(g,t)&&(w=!0),!(!w||j===0)&&(j-(g.stackSize||1)<0?(d.push({...g,stackSize:j}),j=0):(d.push(g),j-=g.stackSize||1))})}),d},[c==null?void 0:c.items,t,s]),u=o.useMemo(()=>{if(!c)return{};const d={};return t&&(c==null||c.items.forEach(b=>{var p;const j=b.selectedQuantity===0;(p=b.items)==null||p.forEach(g=>{if(!g.stashTabId)return;d[g.id]={stashTabId:g.stashTabId},t&&Xe(g,t)&&(d[g.id].filterHighlighted=!0);const w=f.find(T=>T.id===g.id);if(!w){j||(d[g.id].selectedQuantity=0),d[g.id].filterHighlighted&&(d[g.id].showXIcon=!0);return}d[g.id].selectedQuantity=w.stackSize||1})})),x&&(c==null||c.items.forEach(b=>{var j;l[b.hash]&&((j=b.items)==null||j.forEach(p=>{p.stashTabId&&(d[p.id]={...d[p.id],stashTabId:p.stashTabId,highlighted:!0})}))})),d},[c,t,f,l,x]),y=o.useCallback((d,b)=>{const j=c==null?void 0:c.items.find(p=>{var g;return(g=p.items)==null?void 0:g.find(w=>w.id===d.id)});r(j?[j.hash]:[])},[c==null?void 0:c.items,r]),h=o.useRef(null);return e.jsx(Kt,{stashes:v,itemStates:u,onItemSelect:y,disableScrolling:!0,compressed:!0,innerRef:h})},ya=o.memo(ja),wa=({className:a,categoryItem:i,columns:n,listing:t,globalFilter:l,regexFilter:r,showCombinedItemExtraPriceColumn:s,isExpandedListingLoading:m,globalFilterFn:c,onGlobalFilterChange:v,highlightInTable:x,onHighlightInStashView:f,showItemsMode:u,tableRef:y})=>{const h=I(F=>F.selectedListingId?F.selectedItemsMap[F.selectedListingId]:void 0),d=o.useMemo(()=>t?t.meta.listingMode==="bulk"||u==="showAll"?t.items:t.items.filter(F=>{const E=!!(h!=null&&h[F.hash]);return u==="showSelected"?E:!E}):[],[t,u,h]),b=o.useMemo(()=>r&&m||!r||m?d:d.filter(F=>F.selectedQuantity>0),[m,d,r]),j=Lt(),{tableState:p}=Et(j),g=I(F=>F.setSelectedItems),w=I(F=>F.updateData),[T,$]=Xt(),C=Ut(y,x,p.state.pagination,p.setState.onPaginationChange),k=o.useMemo(()=>b.filter(F=>!h||h[F.hash]).map(F=>F.selectedQuantity??0).reduce((F,E)=>F+E,0),[b,h]),M=o.useMemo(()=>{const F=s?[]:["extraPrice"];return{data:b,columns:n,getRowId:E=>E.hash,enableMultiSort:!1,autoResetPageIndex:T,onGlobalFilterChange:v,onRowSelectionChange:g,globalFilterFn:c,...p.setState,state:{globalFilter:l,rowSelection:h,...p.state},initialState:{sorting:[{desc:!0,id:"calculatedTotal"}].filter(E=>{var z;return!((z=i==null?void 0:i.hiddenColumns)!=null&&z.includes(E.id))}),columnVisibility:{cumulative:!1,"2_day_history":!1},columnOrder:["selected","displayName","unsafeHashProperties","quantity","2_day_history","7_day_history","price","extraPrice","calculatedTotal","multiplier","selectedQuantity","cumulative"].filter(E=>{var z;return!((z=i==null?void 0:i.hiddenColumns)!=null&&z.includes(E))&&!F.includes(E)})},meta:{updateData:(E,z,Q)=>{$(),w(E,z,Q)},highlightInStashViewClick:(E,z)=>{f(E,z,"click")},isBlinking:E=>x[E]}}},[s,b,n,T,v,g,c,p.setState,p.state,l,h,i==null?void 0:i.hiddenColumns,$,w,f,x]);return e.jsx("div",{className:a,children:e.jsx(us,{initialTopMostItemIndex:C,options:M,tableRef:y,isLoading:m,insideModal:!0,additinalFooterElement:e.jsxs(P,{children:["Total items: ",k]})})})},va=o.memo(wa);function Na(a={}){const i="selectedQuantity",n="selectedQuantity";return{header:({column:t})=>e.jsx(ee,{column:t,title:n,align:"right"}),id:i,accessorKey:i,enableSorting:!0,enableGlobalFilter:!1,enableResizing:!1,minSize:20,size:77,meta:{headerWording:n},cell:({row:t,table:l,column:r})=>{const{i18n:s}=D(),m=t.getValue(i),c=t.original.maxSelectableQuantity??t.original.quantity,v=`${(c==null?void 0:c.toLocaleString(s.language))??"?"}`,x=f=>{var u,y,h,d,b,j;typeof f=="number"?(y=(u=l.options.meta)==null?void 0:u.updateData)==null||y.call(u,t.id,r.id,f):Number.isNaN(parseFloat(f))?(d=(h=l.options.meta)==null?void 0:h.updateData)==null||d.call(h,t.id,r.id,void 0):(j=(b=l.options.meta)==null?void 0:b.updateData)==null||j.call(b,t.id,r.id,parseFloat(f))};return e.jsx("div",{className:"flex items-center h-full",children:e.jsx(_e,{allowedNumberType:"int",className:"text-center remove-arrow min-w-10 px-1 h-8",value:m??"",min:0,max:c,placeholder:v,onBlur:f=>x(f),debounce:500,allowEmpty:!1})})},...a}}const Sa=(a,i,n,t)=>[ys(),ws({hiddenProps:n}),vs(),xe({mode:"2 days",animation:!1,poe:i}),xe({mode:"7 days",animation:!1,poe:i}),U({poe:i,accessorKey:"price",accessorFn:l=>l.price,headerName:"price",lowConfidenceFn:l=>{var r,s;return{lowConfidence:!!((r=l.valuation)!=null&&r.lowConfidence),listings:((s=l.valuation)==null?void 0:s.listings)||0}}}),U({poe:i,accessorKey:"calculatedTotal",accessorFn:l=>l.price*l.selectedQuantity,headerName:"totalPrice"}),Qe({accessorFn:l=>!l.primaryValuation||l.price===0?"- ":(l.price/l.primaryValuation*100).toLocaleString(a,{minimumFractionDigits:0,maximumFractionDigits:2})}),U({poe:i,accessorKey:"cumulative",headerName:"commulativePrice",cumulativeColumn:"calculatedTotal",enableSorting:!1})],Ca=(a,i,n,t,l,r)=>[Yt(),ys(),ws({hiddenProps:l}),vs({accessorFn:s=>(s.maxSelectableQuantity,s.maxSelectableQuantity!==void 0&&s.maxSelectableQuantity!==s.quantity?`${s.maxSelectableQuantity} / ${s.quantity}`:s.quantity)}),xe({mode:"2 days",animation:!1,poe:i}),xe({mode:"7 days",animation:!1,poe:i}),U({poe:i,accessorKey:"price",accessorFn:s=>s.price,headerName:"price",lowConfidenceFn:s=>{var m,c;return{lowConfidence:!!((m=s.valuation)!=null&&m.lowConfidence),listings:((c=s.valuation)==null?void 0:c.listings)||0}}}),...n?[U({poe:i,accessorKey:"extraPrice",accessorFn:s=>t*s.selectedQuantity,headerName:"combinedExtraPrice"})]:[],U({poe:i,accessorKey:"calculatedTotal",accessorFn:s=>(s.price+t)*s.selectedQuantity,headerName:"totalPrice"}),Qe({accessorFn:s=>!s.primaryValuation||s.price===0?"- ":(s.price/s.primaryValuation*100).toLocaleString(a,{minimumFractionDigits:0,maximumFractionDigits:2})}),Na(),U({poe:i,accessorKey:"cumulative",headerName:"commulativePrice",cumulativeColumn:"calculatedTotal",enableSorting:!1})],Ta=["showAll","showSelected","showUnselected"],ka=Ve("showAll"),$a=ms({columnSizing:{},pageSize:10,columnOrder:[],columnVisiblity:{cumulative:!1,"2_day_history":!1},scrollMode:"infinite"},{persistPrefix:"bulk-listing",version:3}),Fa=()=>{const{t:a,i18n:i}=D(),[n,t]=Oe(ka),l=Re(S=>S.poe),r=Ls(),s=I(G(S=>{var A;return(A=js(S))==null?void 0:A.find(R=>R.uuid===S.selectedListingId)})),m=I(S=>S.setSelectedQuantities),c=ze(),[v,x]=o.useState(!0),[f,u]=o.useState(),[y,h]=o.useState("");o.useEffect(()=>{s!=null&&s.meta.enableRegexSearch?(u(ke(y)),h("")):(u(void 0),h((f==null?void 0:f.search)??""))},[s==null?void 0:s.meta.enableRegexSearch]);const{expandedListing:d,expandedListingInfo:b,isLoading:j}=Es(s,!!f),p=o.useMemo(()=>{if(s)return Ee(s.meta.category,s==null?void 0:s.meta.subCategory)},[s]),g=I(S=>ua(S,s)),w=(p==null?void 0:p.supportsRegex)&&(s==null?void 0:s.meta.enableRegexSearch)&&(s==null?void 0:s.meta.listingMode)==="single",T=v&&w&&!!f,$=T&&!g,C=!!w&&!!(s!=null&&s.meta.regexExtraPrice),k=$&&(s==null?void 0:s.meta.regexExtraPrice)&&(s==null?void 0:s.meta.regexExtraPrice)||0,M=o.useMemo(()=>{if(b)return b.items.flatMap(S=>S.rawItems)},[b]),F=o.useMemo(()=>{if(M)return f?Ye(M,f):M},[M,f]),E=o.useRef(!1);o.useEffect(()=>{T||!E.current||m()},[T,m]),o.useEffect(()=>{if(!b||!F||!T)return;const S={};F.forEach(R=>{var K;const V=b.items.find(Ms=>{var Ae;return((Ae=Ms.rawItems)==null?void 0:Ae.indexOf(R))!==-1});V&&(S[K=V.hash]??(S[K]=0),S[V.hash]+=R.stackSize??1)});const A=Object.entries(S).map(([R,V])=>({hash:R,quantity:V,maxQuantity:V}));E.current=!0,m(A)},[b,F,T,m]);const[z,Q,ie,de,je]=Ps(s,$?f==null?void 0:f.search:void 0),J=o.useMemo(()=>(s==null?void 0:s.meta.listingMode)==="bulk"?Sa(i.language,l,p==null?void 0:p.hiddenColumnProps,p==null?void 0:p.hiddenColumns).filter(S=>S!==void 0):Ca(i.language,l,C,k,p==null?void 0:p.hiddenColumnProps,p==null?void 0:p.hiddenColumns).filter(S=>S!==void 0),[l,s==null?void 0:s.meta.listingMode,i.language,p==null?void 0:p.hiddenColumnProps,p==null?void 0:p.hiddenColumns,C,k]),ue=o.useCallback((S,A,R,V)=>{const K=typeof R!="string"?R.search:R;return A==="displayName"&&S.original.items&&typeof R!="string"&&Ye(S.original.items||[],R).length===0?!1:hs.includesString(S,A,K,V)},[]),W=o.useMemo(()=>{if((s==null?void 0:s.meta.listingMode)==="bulk")return;let S=s==null?void 0:s.meta.minTradeValue;if(S)return(s==null?void 0:s.meta.minTradeType)==="d"&&(S=S*(c||0)),S},[c,s==null?void 0:s.meta.listingMode,s==null?void 0:s.meta.minTradeType,s==null?void 0:s.meta.minTradeValue]),me=o.useMemo(()=>{if(!s)return 0;let S=s.meta.calculatedTotalPrice;return $&&(S+=s.meta.calculatedExtraPrice),S},[s,$]),Z=!!W&&!!s&&me<W,[X,Y]=o.useState("tableView"),[H,se]=o.useState({}),[he,te]=o.useState({}),N=o.useCallback((S,A,R)=>{const V={};if(S===void 0&&A===void 0){if(Object.keys(H).length===0)return;se(V);return}s==null||s.items.forEach(K=>{S!=null&&S.includes(K.hash)&&(V[K.hash]=!0)}),Y("stashTabView"),te({}),se(V)},[s==null?void 0:s.items,H]),L=o.useCallback(S=>{const A=S.reduce((R,V)=>(R[V]=ns(),R),{});Y("tableView"),se({}),te(A)},[]),{tableRef:q,handleTableReset:ye}=gs(),we=!!(s!=null&&s.meta.enableRegexSearch)&&!!(f!=null&&f.search)&&f.search.length>250;return e.jsxs(e.Fragment,{children:[e.jsx(jt,{children:e.jsx(yt,{children:a("title.bulkListing")})}),e.jsx(Ht,{className:"max-h-[70vh]",children:e.jsx(Wt,{value:X,onValueChange:S=>{S==="stashTabView"?te({}):se({}),Y(S)},children:e.jsx("div",{className:"p-2 sm:p-6 pb-0",children:e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[s&&e.jsx(ba,{listing:s,calculatedTotalPrice:me,minTradeValue:W,minValueWarning:Z,categoryItem:p,regexInnerFilterAsSelection:v,regexFilterAsSelection:$,onRegexFilterAsSelection:x}),e.jsx("div",{className:"col-span-full",children:e.jsxs(xs,{storeContext:$a,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{value:(f==null?void 0:f.search)??y??"",onChange:S=>{s!=null&&s.meta.enableRegexSearch?u(ke(String(S))):h(String(S))},onBlur:S=>{s!=null&&s.meta.enableRegexSearch?u(ke(String(S))):h(String(S))},className:B("pl-8 max-w-60",we&&"border-red-1 focus-visible:border-red-1 focus-visible:ring-red-1 border-2"),placeholder:s!=null&&s.meta.enableRegexSearch?a("label.searchRegexPh"):a("label.searchPh"),startIcon:e.jsx("div",{className:"p-2",children:e.jsx(ls,{className:"h-4 w-4 shrink-0 opacity-50"})}),endIcon:e.jsx(e.Fragment,{children:e.jsx(_,{variant:"ghost",size:"inputEndIcon",onClick:()=>{s!=null&&s.meta.enableRegexSearch?u(void 0):h("")},className:B(we&&"border-t-red-1 border-r-red-1 border-b-red-1 border-t-2 border-r-2 border-b-2 focus-visible:ring-red-1"),children:e.jsx(ae,{className:"w-4 h-4"})})})}),X==="tableView"&&(s==null?void 0:s.meta.listingMode)==="single"&&e.jsx("div",{className:"w-full max-w-40",children:e.jsx(fe,{options:Ta,onSelect:S=>t(S.value),value:n,translate:!0})}),e.jsx("div",{className:"flex-1"}),e.jsxs(qt,{children:[e.jsx(Ue,{value:"tableView",children:a("label.tableView")}),e.jsx(Ue,{value:"stashTabView",children:a("label.stashTabView")})]}),X==="tableView"&&e.jsx(fs,{columns:J,resetTable:ye,modal:!0})]}),X==="tableView"&&e.jsx(Be,{value:"tableView",children:e.jsx(va,{categoryItem:p,columns:J,listing:s,globalFilter:y,regexFilter:f,showCombinedItemExtraPriceColumn:C,isExpandedListingLoading:j,globalFilterFn:ue,onGlobalFilterChange:h,highlightInTable:he,onHighlightInStashView:N,showItemsMode:n,tableRef:q})}),X==="stashTabView"&&e.jsx(Be,{value:"stashTabView",children:e.jsx("div",{className:"flex gap-4 items-start",children:e.jsx(ya,{listing:s,expandedOuterListing:d,isExpandedOuterListingLoading:j,regexFilter:f,stashViewItemState:H,onHighligtInTable:L})})})]})})]})})})}),e.jsxs(wt,{className:"fley flex-row justify-end gap-1",children:[e.jsx(rs,{children:e.jsxs(_,{className:"flex flex-row gap-2",variant:ie?"secondary":"default",disabled:z||Q||j||Z||we||!c||!s,onClick:()=>{const S=r.getState();if(!c||!S.selectedListingId||!s)return;const A=$?f==null?void 0:f.search:void 0,R=S.selectedItemsMap[S.selectedListingId],V=s.items.filter(K=>R[K.hash]);Ns(c,s,V,i,A),je()},children:[a(ie?"action.whisperCopied":de?"action.copyWhisperAgain":$?"action.copyRegexWhisper":"action.copyWhisper"),Q&&e.jsx(os,{className:B(Q&&"animate-spin","w-4 h-w shrink-0")})]})}),e.jsx(vt,{asChild:!0,children:e.jsx(_,{type:"button",variant:"secondary",children:a("action.close")})})]})]})},Ia=o.memo(Fa);pe.extend(cs);const La=["showAllModes","showWholeListings","showIndividualListings"],Ea=Ve("showAllModes"),ne=ms({columnSizing:{},pageSize:15,columnOrder:[],columnVisiblity:{},scrollMode:"windowInfinite",rowHeight:49},{persistPrefix:"bulk-listings",version:5}),Ze=a=>a.reduce((i,n)=>(i[n]=ns(),i),{}),Pa=({columns:a,className:i,activeTabNotifications:n,categoryItem:t,isTableLoading:l})=>{const{t:r}=D(),[s,m]=Oe(Ea),[c,v]=I(G(N=>[N.dialogOpen,N.setDialogOpen])),[x,f]=I(G(N=>[N.multiplierRange,N.setMultiplierRange])),[u,y]=o.useState(""),h=I(G(N=>{const L=pe.utc().valueOf();return js(N).filter(q=>q.meta.league===N.league&&N.filteredByGroupListings[q.uuid]&&L-q.meta.timestampMs<At)})),d=o.useMemo(()=>{const N=Math.max(x[1],...h.map(L=>L.meta.multiplier??0),500);return Math.ceil(N/100)*100},[h]);o.useEffect(()=>{x[1]<d&&f([x[0],d])},[d]);const b=o.useMemo(()=>h.filter(N=>N.meta.multiplier===void 0?!0:x[0]<=N.meta.multiplier&&N.meta.multiplier<=x[1]),[h,x]),j=o.useMemo(()=>s==="showAllModes"?b:b.filter(N=>s==="showWholeListings"?N.meta.listingMode==="bulk":N.meta.listingMode==="single"),[b,s]),{tableRef:p,handleTableReset:g}=gs(),[w,T]=Pt(ne),[$,C]=Mt(ne),[k,M]=Rt(ne),[F,E]=Vt(ne),[z,Q]=I(G(N=>[N.tablePageIndex,N.setTablePageIndex])),{pagination:ie,setPagination:de}=Ot(F,E,z,Q),je=o.useCallback(N=>{m(N),Q(0)},[m,Q]),J=o.useCallback(N=>{y(N),Q(0)},[y,Q]);o.useEffect(()=>{const N=Math.ceil(j.length/F)-1;z>N&&N>=0&&Q(N)},[j,Q,z,F]);const ue=o.useRef(new Set),W=o.useRef(),me=xt("tabNotificationSound"),Z=o.useRef([]),[X,Y]=o.useState({}),[H,se]=o.useState([]);o.useEffect(()=>{const N=j.map(L=>L.uuid).filter(L=>!ue.current.has(L));N.length>0&&(N.forEach(L=>ue.current.add(L)),se(n?N:[]))},[j,n]),o.useEffect(()=>{W.current||(W.current=new ga({})),H.length>0&&(me(),document.hasFocus()||(W.current.value+=H.length),document.hidden?Z.current=[...Z.current,...H]:(Y(N=>({...N,...Ze(H)})),setTimeout(()=>{Y(N=>{const L={...N};return H.forEach(q=>delete L[q]),L})},2e3)))},[H]),o.useEffect(()=>{const N=()=>{W.current.value=0,Y(L=>({...L,...Ze(Z.current)})),Z.current=[],setTimeout(()=>{Y({})},2e3)};return window.addEventListener("focus",N),()=>{window.removeEventListener("focus",N)}},[W]);const he=o.useCallback((N,L,q,ye)=>hs.includesString(N,L,q,ye),[]),te=o.useMemo(()=>{const N=t!=null&&t.supportsRegex?[]:["supportRegex","regexExtraPrice"];return{data:j,columns:a,getRowId:L=>L.uuid,autoResetPageIndex:!1,enableMultiSort:!1,onGlobalFilterChange:J,globalFilterFn:he,onColumnVisibilityChange:T,onColumnOrderChange:C,onColumnSizingChange:M,onPaginationChange:de,state:{globalFilter:u,columnVisibility:w,columnOrder:$,columnSizing:k,pagination:ie},initialState:{sorting:[{desc:!0,id:"created"}],columnOrder:["category","listingMode","seller","totalPrice","minTradeValue","multiplier","supportRegex","regexExtraPrice","created","actions"].filter(L=>!N.includes(L))},meta:{isBlinking:L=>X[L]}}},[t==null?void 0:t.supportsRegex,j,a,J,he,T,C,M,de,u,w,$,k,ie,X]);return o.useEffect(()=>{p.current&&(p.current.initialState.columnOrder=te.initialState.columnOrder)},[t==null?void 0:t.supportsRegex]),e.jsx("div",{className:i,children:e.jsxs(Nt,{open:c,onOpenChange:v,children:[e.jsxs(xs,{storeContext:ne,children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(_e,{value:u??"",onChange:N=>J(String(N)),onBlur:N=>J(String(N)),className:"pl-8 max-w-48",placeholder:r("label.searchPh"),startIcon:e.jsx("div",{className:"p-2",children:e.jsx(ls,{className:"h-4 w-4 shrink-0 opacity-50"})}),endIcon:e.jsx(_,{variant:"ghost",size:"inputEndIcon",onClick:()=>{y("")},children:e.jsx(ae,{className:"w-4 h-4"})})}),e.jsx("div",{className:"w-full max-w-48",children:e.jsx(fe,{options:La,onSelect:N=>je(N.value),value:s,translate:!0})}),e.jsxs("div",{className:"flex flex-col items-center gap-2 w-full max-w-48",children:[e.jsx(P,{children:r("label.multiplierRange",{multiplierFrom:x[0],multiplierTo:x[1]})}),e.jsxs(zt,{className:B("relative flex w-full touch-none select-none items-center"),min:0,value:x,max:d,step:5,onValueChange:N=>f(N),children:[e.jsx(_t,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20",children:e.jsx(Qt,{className:"absolute h-full bg-primary"})}),e.jsx(Ke,{className:"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50"}),e.jsx(Ke,{className:"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50"})]})]}),e.jsx("div",{className:"flex-1"}),e.jsx(fs,{columns:a,resetTable:g})]}),e.jsx(us,{options:te,tableRef:p,isLoading:l})]}),e.jsx(St,{className:"max-w-screen-xl overflow-y-auto max-h-screen",children:e.jsx(Ia,{})})]})})},Ma=o.memo(Pa);pe.extend(cs);function Ra({setSelectedCategory:a,setSelectedSubCategory:i}){const n="category",t="category";return{header:({column:l})=>e.jsx(ee,{column:l,title:t,align:"left"}),id:n,accessorKey:n,accessorFn:l=>l.meta.subCategory||l.meta.category,enableSorting:!0,enableGlobalFilter:!0,meta:{headerWording:t,fillRemainingSize:!0},cell:({row:l})=>{const{t:r}=D(),s=l.getValue(n);return e.jsxs("div",{className:"flex items-center gap-2 h-full hover:underline cursor-pointer",onClick:()=>{l.original.meta.subCategory?(a(l.original.meta.category),i(l.original.meta.subCategory)):(a(l.original.meta.category),i(null))},children:[e.jsx("img",{src:l.original.meta.icon,height:32,width:32,alt:l.original.meta.altIcon,sizes:"33vw",style:{width:"auto",height:"32px",objectFit:"contain",flexShrink:0,paddingBlock:"0.125rem"}}),e.jsx("span",{className:"truncate",children:r(`categories.${s}`)})]})}}}function Va(){const a="listingMode",i="listingMode";return{header:({column:n})=>e.jsx(ee,{column:n,title:i,align:"left"}),id:a,accessorKey:a,accessorFn:n=>n.meta.listingMode,enableSorting:!0,enableGlobalFilter:!0,meta:{headerWording:i},cell:({row:n})=>{const{t}=D(),l=n.getValue(a);return e.jsxs("div",{className:"flex items-center gap-1 h-full",children:[l==="bulk"?e.jsx(ps,{className:"w-4 h-4"}):e.jsx(bs,{className:"w-4 h-4"}),e.jsx("span",{className:"truncate",children:t(l==="bulk"?"label.wholeListingShort":"label.individualListingShort")})]})}}}function Oa(){const a="seller",i="seller";return{header:({column:n})=>e.jsx(ee,{column:n,title:i,align:"left"}),id:a,accessorKey:a,accessorFn:n=>n.meta.ign,enableSorting:!0,enableGlobalFilter:!0,meta:{headerWording:i},cell:({row:n})=>{var r;const t=Pe(Me),l=n.getValue(a);return e.jsx("div",{className:"flex items-center gap-2 justify-between h-full",children:e.jsx("div",{className:"flex gap-2 items-center",children:e.jsx("span",{className:"truncate",children:(r=t==null?void 0:t.profile)!=null&&r.uuid?l:"*****"})})})}}}function za(){const a="supportRegex",i="supportRegex";return{header:({column:n})=>e.jsx(ee,{column:n,title:i,align:"right"}),id:a,accessorKey:a,accessorFn:n=>n.meta.enableRegexSearch,enableSorting:!0,enableGlobalFilter:!1,minSize:40,size:80,meta:{headerWording:i},cell:({row:n})=>{const t=n.getValue(a);return e.jsx("div",{className:"flex items-center justify-end h-full",children:t?e.jsx(Le,{className:"h-4 w-4"}):e.jsx(ae,{className:"h-4 w-4"})})}}}function _a(){const a="created",i="created";return{header:({column:n})=>e.jsx(ee,{column:n,title:i,align:"left"}),id:a,accessorKey:a,accessorFn:n=>Math.trunc(n.meta.timestampMs/1e4)*1e4,enableSorting:!0,enableGlobalFilter:!1,meta:{headerWording:i},cell:({row:n})=>{const t=n.getValue(a);return e.jsx("div",{className:"flex items-center h-full",children:e.jsx(ft,{createdAt:pe.utc(t)})})}}}function Qa(){const a="actions",i="actions";return{header:({column:n})=>e.jsx(ee,{column:n,title:i,align:"left"}),id:a,accessorKey:a,enableSorting:!1,enableGlobalFilter:!1,meta:{headerWording:i},cell:({row:n})=>{const{t,i18n:l}=D(),r=ze(),[s,m]=o.useState(!1),c=Ls(),v=I(p=>p.setSelectedListingId),[x,f,u,y,h]=Ps(n.original),d=n.getValue("minTradeValue"),b=n.getValue("totalPrice"),j=!!d&&b<d;return e.jsx(e.Fragment,{children:e.jsx(le,{disableHoverableContent:!0,children:e.jsxs("div",{className:"flex items-center h-full gap-2",children:[e.jsxs(re,{open:s,onOpenChange:m,children:[e.jsx(oe,{asChild:!0,children:e.jsx(_,{size:"icon",variant:"default",className:" shrink-0",onClick:()=>{m(!1),v(n.original.uuid)},children:e.jsx(qs,{className:"h-4 w-4"})})}),e.jsx(ce,{children:t("label.showDetailsTT")})]}),e.jsx(rs,{children:e.jsx(_,{className:"flex gap-2",variant:u?"outline":"secondary",disabled:x||f||j||!r,onClick:()=>{if(!r)return;const p=c.getState().selectedItemsMap[n.original.uuid],g=n.original.items.filter(w=>p[w.hash]);Ns(r,n.original,g,l),h()},children:e.jsxs("span",{className:"truncate",children:[t(u?"action.whisperCopied":y?"action.copyWhisperAgain":"action.copyWhisper"),f&&e.jsx(os,{className:B(f&&"animate-spin","w-4 h-w shrink-0")})]})})})]})})})}}}const Aa=({poe:a,highCurrencyValue:i,lang:n,setSelectedCategory:t,setSelectedSubCategory:l,categoryItem:r})=>[Ra({setSelectedCategory:t,setSelectedSubCategory:l}),Va(),Oa(),U({poe:a,accessorKey:"totalPrice",headerName:"price",accessorFn:s=>s.meta.calculatedTotalPrice,warningWordingFn:(s,m)=>{const c=s.getValue("minTradeValue");if(c&&m<c)return"label.minTradeValueWarning"}}),Jt({poe:a,accessorKey:"minTradeValue",headerName:"minTradeValue",getValue:s=>s.meta.minTradeValue,getValueType:s=>s.meta.minTradeType,accessorFn:s=>s.meta.minTradeValue?s.meta.minTradeType===pt(a,"high")?s.meta.minTradeValue*(i||0):s.meta.minTradeValue:null}),Qe({accessorFn:s=>s.meta.multiplier?s.meta.multiplier.toLocaleString(n,{minimumFractionDigits:0,maximumFractionDigits:2}):"- "}),r!=null&&r.supportsRegex?za():void 0,r!=null&&r.supportsRegex?U({poe:a,accessorKey:"regexExtraPrice",headerName:"combinedRegexExtraPrice",accessorFn:s=>s.meta.regexExtraPrice||0}):void 0,_a(),Qa()],Ga=Ve(!1);function pi(){const{t:a,i18n:i}=D(),[n,t,l]=I(G(T=>[T.league,T.setLeague,T.reset])),r=I(T=>T.poe);Ft(r,n,t,l);const[s,m]=I(G(T=>[T.category,T.setCategory])),[c,v]=I(G(T=>[T.subCategory,T.setSubCategory])),[x,f]=I(G(T=>[T.filterGroups[Gt(T)],T.setFilterGroups])),u=o.useMemo(()=>x??Dt(),[x]),y=ze(),[h,d]=o.useState(!1),b=o.useMemo(()=>Ee(s,c),[s,c]),j=o.useMemo(()=>Aa({poe:r,highCurrencyValue:y,lang:i.language,setSelectedCategory:m,setSelectedSubCategory:v,categoryItem:b}).filter(T=>T!==void 0),[r,b,y,i.language,m,v]),[p,g]=Oe(Ga),[w]=It(T=>({lg:T.viewport.lg}));return e.jsxs(e.Fragment,{children:[e.jsx(ha,{activeTabNotifications:p,setIsTableLoading:d}),e.jsxs("div",{className:B("flex flex-col w-full"),children:[e.jsx(Os,{id:"poexchange-top-ad",type:w.lg?"large-leaderboard":"medium-leaderboard"}),e.jsxs("div",{className:"flex flex-col gap-2 flew-grow",children:[e.jsxs("div",{className:"flex flex-col gap-4 lg:flex-row",children:[e.jsx("div",{className:"flex flex-row justify-between gap-4 lg:basis-1/2",children:e.jsxs("div",{className:"flex flex-col flex-wrap justify-start gap-4",children:[e.jsxs("div",{className:"flex flex-row gap-2",children:[e.jsx(Ge,{className:"flex w-48",isSubCategory:!1,category:s,subCategory:c,onCategorySelect:m,onSubCategorySelect:v}),e.jsx(Ge,{className:"flex w-48",isSubCategory:!0,category:s,subCategory:c,onCategorySelect:m,onSubCategorySelect:v,enableUnselect:!0})]}),e.jsx(le,{children:e.jsxs(re,{children:[e.jsx(oe,{asChild:!0,children:e.jsxs("div",{className:"flex flex-row items-center gap-2 cursor-pointer",onClick:()=>g(T=>!T),children:[e.jsx(Is,{checked:p}),e.jsx(P,{className:"cursor-pointer",children:a("action.toggleTabNotifications")})]})}),e.jsx(ce,{children:e.jsx(P,{children:a("label.toggleTabNotificationsTT")})})]})})]})}),e.jsx(Ct,{defaultValue:"item-1",type:"single",collapsible:!0,className:"flex lg:basis-1/2 flew-grow",children:e.jsxs(Tt,{className:"w-full",value:"item-1",children:[e.jsx(kt,{children:a("title.itemFilter")}),e.jsx($t,{children:s?e.jsx(na,{className:"",league:n,category:s,subCategory:c,filterGroups:u,onFilterGroupsChange:f}):e.jsx("div",{children:a("label.selectCategoryToFilter")})})]})})]}),e.jsx(Ma,{className:"flex flex-col col-span-4 gap-2 mb-56",columns:j,activeTabNotifications:p,categoryItem:b,isTableLoading:h})]})]})]})}export{pi as A,I as d};
