import{r as n,j as e}from"./jsx-runtime-BmCkTyBI.js";import{H as A,f as O,G as fe,L as je,e as ye,F as be,m as Y,a2 as Fe,a3 as Re,y as we,a4 as Ee,a5 as ve,n as q,X as me,p as oe,a6 as Ve,a7 as Le,J as Oe,a8 as $e,a9 as He,U as _e,aa as g,ab as L,ac as I,C as De,ad as qe,ae as Ge,af as Qe}from"./useUiStateStore-BTW2eq2x.js";import{$ as X,s as ze,E as Be,I as Ke,i as Ae,g as Ue,P as Je}from"./hover-card-evu0jAM8.js";import{a as We}from"./quantity-column-6vZwNzJV.js";import{s as Xe}from"./index-0f3ee958-DZWNGZaJ.js";import"./index-B7uSRlxY.js";import{l as de,m as Ze,v as Ye,T as ea}from"./useListingToolStore-CdZOxAv4.js";import{t as ue,n as W}from"./input-CP8d1LBk.js";import{j as aa,k as sa,D as ta,h as ia,c as Z,w as la,F as na}from"./dialog-BgY3zGCx.js";import{f as xe}from"./store-provider-zBsskQKl.js";import{t as ge,y as pe}from"./layout-list-CWMZJz9E.js";const ra=({listing:t,buyOffering:P,selectedItems:l,valuations:j,notificationId:p})=>{const{t:i}=A(),[x,h]=n.useState(!1);return t.meta.wholeOffering?e.jsx(ma,{listing:t,notificationId:p}):e.jsxs(aa,{open:x,onOpenChange:h,children:[e.jsx(sa,{asChild:!0,children:e.jsx(O,{children:i("action.updateOffering")})}),e.jsx(ta,{className:"max-w-2xl",children:e.jsx(oa,{listing:t,buyOffering:P,selectedItems:l,valuations:j,notificationId:p})})]})},ca=n.memo(ra),ma=({listing:t,notificationId:P})=>{const{t:l}=A(),j=fe(),p=je(ye),i=be(),x=Y(r=>r.poe),h=n.useCallback(r=>r==null?void 0:r.find(w=>w.uuid===t.uuid),[t.uuid]),{data:C,isLoading:y}=Fe({...Re(p),select:h}),{mutate:F,isPending:b}=we({mutationFn:({league:r,category:w,subCategory:k,toDelete:c})=>Ee(r,w,k,c),onMutate:async()=>{var r;await j.cancelQueries({queryKey:["my-listings",(r=p==null?void 0:p.profile)==null?void 0:r.uuid]})},onSuccess:()=>{var r;i(`/${x}/poexchange/bulk-trade/my-listings`,{replace:!0}),j.invalidateQueries({queryKey:["my-listings",(r=p==null?void 0:p.profile)==null?void 0:r.uuid]})}});return C!=null&&C.inactive?null:e.jsx(e.Fragment,{children:e.jsxs(O,{className:"flex flex-row gap-2",onClick:()=>{F({league:t.meta.league,category:t.meta.category,subCategory:t.meta.subCategory,uuid:t.uuid,toDelete:!1})},children:[l("action.removeOffering"),b||y&&e.jsx(ve,{className:q(b&&"animate-spin","w-4 h-w shrink-0")})]})})},oa=({listing:t,buyOffering:P,selectedItems:l,valuations:j,notificationId:p})=>{const{t:i,i18n:x}=A(["common","notification"]),h=Y(a=>a.poe),C=fe(),y=je(ye),F=be(),[b,r]=n.useState(!0),[w,k]=n.useState(!0),c=me(t.meta.category,t.meta.subCategory),{unselectedItems:G,overprices:Q,categoryMultiplier:z,listingMode:R,minTradeValue:$,minTradeType:N,customGroup:m}=de(oe(a=>{const o=xe(void 0,t.meta.category,t.meta.subCategory);return{unselectedItems:a.unselectedItems,overprices:a.overprices,categoryMultiplier:a.categoryMultiplier[o]||100,listingMode:a.categoryListingMode[o]||"single",minTradeValue:a.minTradeValue[o],minTradeType:a.minTradeType[o],customGroup:a.customGroups[(c==null?void 0:c.name)||""]}})),[T,B]=n.useState(R??"single"),[v,f]=n.useState(z),[u,H]=n.useState($),[_,Ne]=n.useState(N),[S,ee]=n.useState((m==null?void 0:m.meta.enableRegexSearch)||!1),[E,ae]=n.useState(m==null?void 0:m.meta.regexExtraPrice),[D,se]=n.useState(m==null?void 0:m.meta.basePrice),s=n.useMemo(()=>{const a=Ve(P,j==null?void 0:j[P.meta.league],"toMax",{updateQuantities:b,updatePrices:w,selectedItems:l,unselectedItems:G,multiplier:v,categoryItem:c,overprices:Q,customGroup:m,basePrice:D});if(a){const o=T==="single",M=o&&!!(c!=null&&c.supportsRegex)&&!!S||void 0;a.meta.listingMode=T,a.meta.minTradeValue=o&&u||void 0,a.meta.minTradeType=o&&_||void 0,a.meta.enableRegexSearch=M,a.meta.regexExtraPrice=M&&E||void 0}return a},[D,P,c,m,S,T,_,u,v,Q,E,l,G,w,b,j]),V=Le(),Te=n.useMemo(()=>!t||!t.meta.multiplier?"- ":t.meta.multiplier.toLocaleString(x.language,{minimumFractionDigits:0,maximumFractionDigits:2}),[x.language,t]),Se=n.useMemo(()=>!s||!s.meta.multiplier?"- ":s.meta.multiplier.toLocaleString(x.language,{minimumFractionDigits:0,maximumFractionDigits:2}),[x.language,s]),Me=n.useMemo(()=>{if((t==null?void 0:t.meta.listingMode)==="bulk")return;let a=t==null?void 0:t.meta.minTradeValue;if(a)return(t==null?void 0:t.meta.minTradeType)==="d"&&(a=a*(V||0)),a},[t==null?void 0:t.meta.listingMode,t==null?void 0:t.meta.minTradeValue,t==null?void 0:t.meta.minTradeType,V]),Pe=n.useMemo(()=>{if((s==null?void 0:s.meta.listingMode)==="bulk")return;let a=s==null?void 0:s.meta.minTradeValue;if(a)return(s==null?void 0:s.meta.minTradeType)==="d"&&(a=a*(V||0)),a},[s==null?void 0:s.meta.listingMode,s==null?void 0:s.meta.minTradeValue,s==null?void 0:s.meta.minTradeType,V]),te=n.useMemo(()=>{if(!s)return!1;let a=u||0;if(_==="d"&&(a=a*(V||0)),s.meta.calculatedTotalPrice<a)return!0},[V,_,u,s]),Ce=Oe(),{mutate:ie,isPending:U}=we({mutationFn:$e,onMutate:async()=>{var a;await C.cancelQueries({queryKey:["my-listings",(a=y==null?void 0:y.profile)==null?void 0:a.uuid]})},onError:a=>{Ce(i("notification:error.title.postListing"),"error")},onSuccess:(a,o,M)=>{var d;F(`/${h}/poexchange/bulk-trade/my-listings`,{replace:!0}),C.invalidateQueries({queryKey:["my-listings",(d=y==null?void 0:y.profile)==null?void 0:d.uuid]})}}),[le,ne,re,ce,J]=de(oe(a=>[a.setMultiplier,a.setCategoryListingMode,a.setMinTradeType,a.setMinTradeValue,a.updateCustomGroupMeta])),ke=n.useCallback(()=>{if(!s)return;const a={uuid:He(),userId:s.userId,meta:{league:s.meta.league,category:s.meta.category,subCategory:s.meta.subCategory||"ALL",ign:s.meta.ign,listingMode:s.meta.listingMode,timestampMs:_e.utc().valueOf(),locale:x.language,stashTabs:s.meta.stashTabs,minTradeValue:s.meta.minTradeValue,minTradeType:s.meta.minTradeType,totalPrice:s.items.reduce((d,K)=>K.price*K.quantity+d,0),enableRegexSearch:s.meta.enableRegexSearch,regexExtraPrice:s.meta.regexExtraPrice},items:s.items.sort((d,K)=>d.displayName.localeCompare(K.displayName)).map(d=>({pHash:d.pHash,tHash:d.tHash,hash:d.hash,quantity:d.quantity,price:d.price,s:{k:d.displayName,i:d.icon.replaceAll("https://web.poecdn.com/gen/image/",""),p:d.unsafeHashProperties,t:d.tag||""},rawItems:d.items}))},o=xe(void 0,s.meta.category,s.meta.subCategory);le(v,o),ne(s.meta.listingMode,o),ce($??void 0,o),re(N||"c",o);const M=me(s.meta.category,s.meta.subCategory);M&&M.supportsRegex&&(M.customProps?J(M.name,{enableRegexSearch:S,regexExtraPrice:E,basePrice:D,tieredPrices:(m==null?void 0:m.meta.tieredPrices)||[]}):J(M.name,{enableRegexSearch:S,regexExtraPrice:E})),ie(a)},[D,m==null?void 0:m.meta.tieredPrices,S,x.language,N,$,v,s,E,ne,re,ce,le,J,ie]),Ie=n.useMemo(()=>t?t.items.reduce((a,o)=>a+o.price*o.quantity,0):0,[t]);return!t||!s||!c?e.jsx("div",{children:i("label.loading")}):e.jsxs(e.Fragment,{children:[e.jsx(ia,{children:i("title.updateMyOffering")}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid grid-cols-11 w-full gap-1 text-sm gap-x-3 h-fit",children:[e.jsx(g,{className:"col-span-2 text-sm",children:i("label.category")}),e.jsxs("div",{className:"col-span-9 flex flex-row gap-1 items-center",children:[e.jsx("img",{className:"max-w-5 max-h-5 shrink-0",src:t.meta.icon,width:20,height:20,alt:t.meta.altIcon}),e.jsx("div",{children:i(`categories.${t.meta.subCategory||t.meta.category}`)})]}),e.jsx(g,{className:"col-span-2 text-sm",children:i("label.sellMode")}),e.jsx("div",{className:"col-span-4 flex flex-row gap-1 items-center",children:t.meta.listingMode==="bulk"?e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"w-4 h-4"}),i("label.wholeListingShort")]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"w-4 h-4"}),i("label.individualListingShort")]})}),e.jsx("div",{className:"col-span-1 flex items-center",children:e.jsx(L,{className:"w-4 h-4"})}),e.jsx("div",{className:"col-span-4 flex flex-row gap-1 items-center",children:s.meta.listingMode==="bulk"?e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"w-4 h-4"}),i("label.wholeListingShort")]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"w-4 h-4"}),i("label.individualListingShort")]})}),e.jsx(g,{className:"col-span-2 text-sm",children:i("label.totalPrice")}),e.jsx("div",{className:"col-span-4 flex flew-row gap-2 items-center w-fit",children:e.jsx(I,{poe:h,value:Ie})}),e.jsx("div",{className:"col-span-1 flex items-center",children:e.jsx(L,{className:"w-4 h-4"})}),e.jsx("div",{className:"col-span-4 flex flew-row gap-2 items-center w-fit",children:e.jsx(I,{poe:h,value:s.meta.calculatedTotalPrice})}),e.jsx(g,{className:"col-span-2 text-sm",children:i("label.minTradeValue")}),e.jsx("div",{className:"col-span-4 flex flew-row gap-2 items-center w-fit",children:e.jsx(I,{poe:h,value:Me})}),e.jsx("div",{className:"col-span-1 flex items-center",children:e.jsx(L,{className:"w-4 h-4"})}),e.jsx("div",{className:"col-span-4 flex flew-row gap-2 items-center w-fit",children:T==="bulk"?"- ":e.jsx(I,{poe:h,value:Pe})}),!c.customProps&&e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"col-span-2 text-sm",children:i("label.multiplierLabel")}),e.jsxs("div",{className:"col-span-4",children:[Te,"%"]}),e.jsx("div",{className:"col-span-1 flex items-center",children:e.jsx(L,{className:"w-4 h-4"})}),e.jsxs("div",{className:q("col-span-4",s.meta.multiplier&&s.meta.multiplier>500&&"text-red-1"),children:[Se,"%"]})]}),c.supportsRegex&&e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"col-span-2 text-sm",children:i("label.regexSearchEnabledLabel")}),e.jsx("div",{className:"col-span-4 flex items-center",children:t.meta.enableRegexSearch?e.jsx(ue,{className:"h-4 w-4"}):e.jsx(Z,{className:"h-4 w-4"})}),e.jsx("div",{className:"col-span-1 flex items-center",children:e.jsx(L,{className:"w-4 h-4"})}),e.jsx("div",{className:"col-span-4 flex items-center",children:s.meta.enableRegexSearch?e.jsx(ue,{className:"h-4 w-4"}):e.jsx(Z,{className:"h-4 w-4"})}),e.jsx(g,{className:"col-span-2 text-sm",children:i("label.regexExtraPriceLabel")}),e.jsx("div",{className:"col-span-4 flex flew-row gap-2 items-center w-fit",children:e.jsx(I,{poe:h,value:t.meta.regexExtraPrice})}),e.jsx("div",{className:"col-span-1 flex items-center",children:e.jsx(L,{className:"w-4 h-4"})}),e.jsx("div",{className:"col-span-4 flex flew-row gap-2 items-center w-fit",children:e.jsx(I,{poe:h,value:s.meta.regexExtraPrice})})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex flex-row items-center gap-2 cursor-pointer w-fit",onClick:()=>r(!b),children:[e.jsx(W,{checked:b,onCheckedChange:a=>r(a===!0)}),e.jsx(g,{className:"cursor-pointer select-none",children:i("label.updateQuantities")})]}),e.jsx("div",{className:"text-[0.8rem] font-medium",children:i("label.updateQuantitiesDescription")}),e.jsxs("div",{className:"flex flex-row items-center gap-2 cursor-pointer w-fit",onClick:()=>k(!w),children:[e.jsx(W,{checked:w,onCheckedChange:a=>k(a===!0)}),e.jsx(g,{className:"cursor-pointer select-none",children:i("label.updatePrices")})]}),e.jsx("div",{className:"text-[0.8rem] font-medium",children:i("label.updatePricesDescription")}),c.customProps&&e.jsxs("div",{className:"flex justify-between items-center gap-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(g,{className:"truncate",children:i("label.8modBasePrice")})}),e.jsx(X,{allowedNumberType:"float",className:"max-w-12 h-8 text-center remove-arrow p-1",value:D||"",min:0,placeholder:"0c",onChange:a=>{se(a?parseFloat(a.toString()):void 0)},onBlur:a=>{se(a?parseFloat(a.toString()):void 0)},debounce:500})]}),w&&e.jsxs("div",{className:"space-y-1 mb-2",children:[e.jsxs(g,{className:q(s.meta.multiplier&&s.meta.multiplier>500&&"text-red-1"),children:[i("label.multiplier",{multiplier:v}),` ${s.meta.multiplier&&v!==s.meta.multiplier?`(${s.meta.multiplier}%)`:""}`]}),e.jsx(Ze,{min:0,value:[v],max:500,step:2.5,onValueChange:a=>{f(a[0])}})]}),e.jsx(Ye,{listingMode:T,onListingModeChange:B}),T!=="bulk"&&e.jsxs("div",{className:"flex items-center gap-2 justify-between",children:[e.jsx(g,{children:i("label.minTradeValue")}),e.jsx(ea,{minTradeValue:u,minTradeType:_,minTradeValueWarning:te,setMinTradeValue:H,setMinTradeType:Ne})]}),T==="single"&&!!c.supportsRegex&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-row items-center gap-2 cursor-pointer w-fit",onClick:()=>ee(!S),children:[e.jsx(W,{className:"select-none",checked:S,onCheckedChange:()=>ee(!S)}),e.jsx(g,{className:"cursor-pointer select-none",children:i("label.allowRegexSearch")})]}),S&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-center gap-2 justify-between",children:[e.jsx(g,{className:"cursor-pointer select-none",children:i("label.regexExtraPrice")}),e.jsx(X,{allowedNumberType:"float",className:"max-w-12 h-8 text-center remove-arrow p-1",value:E||"",min:0,placeholder:"0c",onChange:a=>{ae(a?parseFloat(a.toString()):void 0)},onBlur:a=>{ae(a?parseFloat(a.toString()):void 0)},debounce:500})]})})]})]})]}),e.jsxs(la,{className:"fley flex-row justify-end gap-1",children:[e.jsx(na,{asChild:!0,children:e.jsx(O,{type:"button",variant:"secondary",children:i("action.close")})}),e.jsxs(O,{className:"flex flex-row gap-2",onClick:ke,disabled:U||s.meta.calculatedTotalPrice===0||v===0||s.meta.multiplier&&s.meta.multiplier>500||te,children:[i("action.updateOffering"),U&&e.jsx(ve,{className:q(U&&"animate-spin","w-4 h-w shrink-0")})]})]})]})};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const da=[["path",{d:"M17 3v10",key:"15fgeh"}],["path",{d:"m12.67 5.5 8.66 5",key:"1gpheq"}],["path",{d:"m12.67 10.5 8.66-5",key:"1dkfa6"}],["path",{d:"M9 17a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2v-2z",key:"swwfx4"}]],ua=De("regex",da),he=ze({columnSizing:{},pageSize:15,columnOrder:[],columnVisiblity:{cumulative:!1,"2_day_history":!1},scrollMode:"infinite"},{persistPrefix:"bulk-trade-listing",version:2}),xa=({className:t,notificationId:P,listing:l,buyOffering:j,selectedItems:p,isBuyOfferingError:i,showCombinedItemExtraPriceColumn:x,appliedCombinedItemExtraPrice:h,valuations:C,columns:y,globalFilterFn:F,globalFilter:b,onGlobalFilterChange:r,disableScrolling:w,highlightInTable:k,onHighlightInStashView:c})=>{const{t:G}=A(),Q=Y(f=>f.poe),z=n.useMemo(()=>(l==null?void 0:l.items.filter(f=>f.selectedQuantity!==0))||[],[l==null?void 0:l.items]),{tableRef:R,handleTableReset:$}=Be(),{tableState:N}=Ke(he),m=n.useMemo(()=>[10,15,25,50,75,100],[]),T=We(R,k,N.state.pagination,N.setState.onPaginationChange,w),[B]=Xe(f=>({lg:f.viewport.lg})),v=n.useMemo(()=>{const f=x?[]:["extraPrice"];return{data:z,columns:y,getRowId:u=>u.hash,onGlobalFilterChange:r,globalFilterFn:F,...N.setState,state:{globalFilter:b,...N.state},initialState:{sorting:[{desc:!0,id:"calculatedTotal"}],columnVisibility:{tag:!1,cumulative:!1,"2_day_history":!1,"7_day_history":!1,multiplier:!1},columnOrder:["displayName","unsafeHashProperties","quantity","2_day_history","7_day_history","price","extraPrice","calculatedTotal","multiplier","cumulative"].filter(u=>!f.includes(u))},meta:{highlightInStashViewClick:(u,H)=>{c(u,H,"click")},...B.lg?{highlightInStashViewHover:(u,H)=>{c(u,H,"hover")}}:void 0,isBlinking:u=>k[u]}}},[x,z,y,r,F,N.setState,N.state,b,B.lg,c,k]);return n.useEffect(()=>{R.current&&(R.current.initialState.columnOrder=v.initialState.columnOrder)},[x]),e.jsx(Ae,{storeContext:he,children:e.jsxs("div",{className:t,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{value:b??"",onChange:f=>r(String(f)),onBlur:f=>r(String(f)),className:q("pl-8 max-w-60",(l==null?void 0:l.meta.buyRegex)&&"pr-[4.5rem]"),placeholder:G("label.searchRegexPh"),startIcon:e.jsx("div",{className:"p-2",children:e.jsx(qe,{className:"h-4 w-4 shrink-0 opacity-50"})}),endIcon:e.jsxs(e.Fragment,{children:[(l==null?void 0:l.meta.buyRegex)&&e.jsx(Ge,{children:e.jsx(O,{variant:"ghost",size:"inputEndIcon",onClick:()=>{r(l.meta.buyRegex),navigator.clipboard.writeText(l.meta.buyRegex)},children:e.jsx(ua,{className:"w-4 h-4"})})}),e.jsx(O,{variant:"ghost",size:"inputEndIcon",onClick:()=>{r("")},children:e.jsx(Z,{className:"w-4 h-4"})})]})}),l&&e.jsx(Qe,{variant:"secondary",children:e.jsx(I,{poe:Q,value:l.meta.calculatedTotalPrice+(h?l.meta.calculatedExtraPrice:0)})}),e.jsx("div",{className:"flex-1"}),j&&!i&&l&&e.jsx(ca,{listing:l,notificationId:P,buyOffering:j,selectedItems:p,valuations:C}),e.jsx(Ue,{columns:y,resetTable:$})]}),e.jsx(Je,{initialTopMostItemIndex:T,options:v,pageSizes:m,tableRef:R})]})})},Sa=n.memo(xa);export{Sa as R};
